/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @license
 * Copyright Workylab. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://raw.githubusercontent.com/workylab/materialize-angular/master/LICENSE
 */
import { Directive, ElementRef, HostListener, Input, Renderer2 } from '@angular/core';
import { config } from '../../config';
/**
 * @record
 */
function Coordinate() { }
if (false) {
    /** @type {?} */
    Coordinate.prototype.x;
    /** @type {?} */
    Coordinate.prototype.y;
}
var RippleDirective = /** @class */ (function () {
    function RippleDirective(elementRef, renderer) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.rippleDuration = 500;
        this.isRippleActive = true;
        this.isRippleCenter = false;
        this.prefix = config.components.prefix;
        this.createRipple = this.createRipple.bind(this);
        this.element = this.elementRef.nativeElement;
        this.renderer.addClass(this.element, this.prefix + "-ripple-element");
    }
    /**
     * @return {?}
     */
    RippleDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (!this.isRippleActive) {
            this.renderer.addClass(this.element, 'disabled');
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    RippleDirective.prototype.createRipple = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.isRippleActive) {
            return;
        }
        /** @type {?} */
        var coordinates = this.isRippleCenter
            ? this.getCoordinatesByCenter()
            : this.getCoordinatesByEvent(event);
        /** @type {?} */
        var radio = this.getRippleRadio(coordinates);
        this.renderRipple(radio, coordinates);
    };
    /**
     * @param {?} radio
     * @param {?} coordinate
     * @return {?}
     */
    RippleDirective.prototype.renderRipple = /**
     * @param {?} radio
     * @param {?} coordinate
     * @return {?}
     */
    function (radio, coordinate) {
        /** @type {?} */
        var ripple = this.renderer.createElement('div');
        /** @type {?} */
        var centerY = coordinate.y - radio;
        /** @type {?} */
        var centerX = coordinate.x - radio;
        this.renderer.addClass(ripple, 'ripple');
        this.renderer.setStyle(ripple, 'height', radio * 2 + "px");
        this.renderer.setStyle(ripple, 'width', radio * 2 + "px");
        this.renderer.setStyle(ripple, 'top', centerY + "px");
        this.renderer.setStyle(ripple, 'left', centerX + "px");
        this.renderer.insertBefore(this.element, ripple, this.element.firstChild);
        this.scaleRipple(ripple);
    };
    /**
     * @return {?}
     */
    RippleDirective.prototype.getCoordinatesByCenter = /**
     * @return {?}
     */
    function () {
        var _a = this.element, offsetHeight = _a.offsetHeight, offsetWidth = _a.offsetWidth;
        /** @type {?} */
        var y = offsetHeight / 2;
        /** @type {?} */
        var x = offsetWidth / 2;
        return { x: x, y: y };
    };
    /**
     * @param {?} event
     * @return {?}
     */
    RippleDirective.prototype.getCoordinatesByEvent = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var offset = this.getOffset(this.element);
        /** @type {?} */
        var y = event.pageY - offset.top;
        /** @type {?} */
        var x = event.pageX - offset.left;
        return { x: x, y: y };
    };
    /**
     * @param {?} coordinate
     * @return {?}
     */
    RippleDirective.prototype.getRippleRadio = /**
     * @param {?} coordinate
     * @return {?}
     */
    function (coordinate) {
        /** @type {?} */
        var height = Math.max(this.element.offsetHeight - coordinate.y, coordinate.y);
        /** @type {?} */
        var width = Math.max(this.element.offsetWidth - coordinate.x, coordinate.x);
        /** @type {?} */
        var radio = Math.hypot(height, width);
        return radio;
    };
    /**
     * @param {?} ripple
     * @return {?}
     */
    RippleDirective.prototype.scaleRipple = /**
     * @param {?} ripple
     * @return {?}
     */
    function (ripple) {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            ripple.style.transitionDuration = _this.rippleDuration + "ms";
            ripple.style.transform = 'scale(1)';
            _this.hideRipple(ripple);
        }), 0);
    };
    /**
     * @param {?} ripple
     * @return {?}
     */
    RippleDirective.prototype.hideRipple = /**
     * @param {?} ripple
     * @return {?}
     */
    function (ripple) {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.renderer.setStyle(ripple, 'transitionDuration', _this.rippleDuration + "ms");
            _this.renderer.setStyle(ripple, 'opacity', '0');
            _this.removeRipple(ripple);
        }), this.rippleDuration);
    };
    /**
     * @param {?} ripple
     * @return {?}
     */
    RippleDirective.prototype.removeRipple = /**
     * @param {?} ripple
     * @return {?}
     */
    function (ripple) {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.renderer.removeChild(_this.element, ripple);
        }), this.rippleDuration);
    };
    /**
     * @param {?} element
     * @return {?}
     */
    RippleDirective.prototype.getOffset = /**
     * @param {?} element
     * @return {?}
     */
    function (element) {
        /** @type {?} */
        var rect = element.getBoundingClientRect();
        /** @type {?} */
        var top = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        /** @type {?} */
        var left = window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0;
        /** @type {?} */
        var offset = {
            left: rect.left + left,
            top: rect.top + top
        };
        return offset;
    };
    RippleDirective.decorators = [
        { type: Directive, args: [{
                    selector: "[" + config.components.prefix + "Ripple]"
                },] }
    ];
    /** @nocollapse */
    RippleDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    RippleDirective.propDecorators = {
        rippleDuration: [{ type: Input }],
        isRippleActive: [{ type: Input }],
        isRippleCenter: [{ type: Input }],
        createRipple: [{ type: HostListener, args: ['mousedown', ['$event'],] }]
    };
    return RippleDirective;
}());
export { RippleDirective };
if (false) {
    /** @type {?} */
    RippleDirective.prototype.rippleDuration;
    /** @type {?} */
    RippleDirective.prototype.isRippleActive;
    /** @type {?} */
    RippleDirective.prototype.isRippleCenter;
    /**
     * @type {?}
     * @private
     */
    RippleDirective.prototype.element;
    /**
     * @type {?}
     * @private
     */
    RippleDirective.prototype.prefix;
    /**
     * @type {?}
     * @private
     */
    RippleDirective.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    RippleDirective.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmlwcGxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21hdGVyaWFsaXplLWFuZ3VsYXIvIiwic291cmNlcyI6WyJhcHAvY29tcGxldGVkLWNvbXBvbmVudHMvY29tbW9uL3JpcHBsZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sY0FBYyxDQUFDOzs7O0FBRXRDLHlCQUdDOzs7SUFGQyx1QkFBVTs7SUFDVix1QkFBVTs7QUFHWjtJQVdFLHlCQUFvQixVQUFzQixFQUFVLFFBQW1CO1FBQW5ELGVBQVUsR0FBVixVQUFVLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBUDlELG1CQUFjLEdBQUcsR0FBRyxDQUFDO1FBQ3JCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBR3hCLFdBQU0sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQztRQUd4QyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWpELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUM7UUFDN0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBTSxJQUFJLENBQUMsTUFBTSxvQkFBa0IsQ0FBQyxDQUFDO0lBQzFFLENBQUM7Ozs7SUFFRCxrQ0FBUTs7O0lBQVI7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN4QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFVBQVUs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QUFXLElBQUksUUFBUSxDQUFDLGVBQWUsQ0FBQyxTQUFTLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksQ0FBQzs7WUFDOUYsSUFBSSxHQUFHLE1BQU0sQ0FBQyxXQUFXLElBQUksUUFBUSxDQUFDLGVBQWUsQ0FBQyxVQUFVLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksQ0FBQzs7WUFFakcsTUFBTSxHQUFHO1lBQ2IsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSTtZQUN0QixHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHO1NBQ3BCO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQzs7Z0JBcEhGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsTUFBSyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sWUFBVTtpQkFDbEQ7Ozs7Z0JBVm1CLFVBQVU7Z0JBQStCLFNBQVM7OztpQ0FZbkUsS0FBSztpQ0FDTCxLQUFLO2lDQUNMLEtBQUs7K0JBa0JMLFlBQVksU0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBNkZ2QyxzQkFBQztDQUFBLEFBckhELElBcUhDO1NBbEhZLGVBQWU7OztJQUMxQix5Q0FBOEI7O0lBQzlCLHlDQUErQjs7SUFDL0IseUNBQWdDOzs7OztJQUVoQyxrQ0FBNkI7Ozs7O0lBQzdCLGlDQUEwQzs7Ozs7SUFFOUIscUNBQThCOzs7OztJQUFFLG1DQUEyQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBXb3JreWxhYi4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vd29ya3lsYWIvbWF0ZXJpYWxpemUtYW5ndWxhci9tYXN0ZXIvTElDRU5TRVxuICovXG5cbmltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLCBJbnB1dCwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZyc7XG5cbmludGVyZmFjZSBDb29yZGluYXRlIHtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogYFskeyBjb25maWcuY29tcG9uZW50cy5wcmVmaXggfVJpcHBsZV1gXG59KVxuZXhwb3J0IGNsYXNzIFJpcHBsZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIHJpcHBsZUR1cmF0aW9uID0gNTAwO1xuICBASW5wdXQoKSBpc1JpcHBsZUFjdGl2ZSA9IHRydWU7XG4gIEBJbnB1dCgpIGlzUmlwcGxlQ2VudGVyID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBlbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBwcmVmaXggPSBjb25maWcuY29tcG9uZW50cy5wcmVmaXg7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICB0aGlzLmNyZWF0ZVJpcHBsZSA9IHRoaXMuY3JlYXRlUmlwcGxlLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudCwgYCR7IHRoaXMucHJlZml4IH0tcmlwcGxlLWVsZW1lbnRgKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICghdGhpcy5pc1JpcHBsZUFjdGl2ZSkge1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQsICdkaXNhYmxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZG93bicsIFsnJGV2ZW50J10pXG4gIGNyZWF0ZVJpcHBsZShldmVudDogYW55KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzUmlwcGxlQWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLmlzUmlwcGxlQ2VudGVyXG4gICAgICA/IHRoaXMuZ2V0Q29vcmRpbmF0ZXNCeUNlbnRlcigpXG4gICAgICA6IHRoaXMuZ2V0Q29vcmRpbmF0ZXNCeUV2ZW50KGV2ZW50KTtcblxuICAgIGNvbnN0IHJhZGlvID0gdGhpcy5nZXRSaXBwbGVSYWRpbyhjb29yZGluYXRlcyk7XG5cbiAgICB0aGlzLnJlbmRlclJpcHBsZShyYWRpbywgY29vcmRpbmF0ZXMpO1xuICB9XG5cbiAgcmVuZGVyUmlwcGxlKHJhZGlvOiBudW1iZXIsIGNvb3JkaW5hdGU6IENvb3JkaW5hdGUpIHtcbiAgICBjb25zdCByaXBwbGUgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGNlbnRlclkgPSBjb29yZGluYXRlLnkgLSByYWRpbztcbiAgICBjb25zdCBjZW50ZXJYID0gY29vcmRpbmF0ZS54IC0gcmFkaW87XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHJpcHBsZSwgJ3JpcHBsZScpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShyaXBwbGUsICdoZWlnaHQnLCBgJHsgcmFkaW8gKiAyIH1weGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUocmlwcGxlLCAnd2lkdGgnLCBgJHsgcmFkaW8gKiAyIH1weGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUocmlwcGxlLCAndG9wJywgYCR7IGNlbnRlclkgfXB4YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShyaXBwbGUsICdsZWZ0JywgYCR7IGNlbnRlclggfXB4YCk7XG4gICAgdGhpcy5yZW5kZXJlci5pbnNlcnRCZWZvcmUodGhpcy5lbGVtZW50LCByaXBwbGUsIHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblxuICAgIHRoaXMuc2NhbGVSaXBwbGUocmlwcGxlKTtcbiAgfVxuXG4gIGdldENvb3JkaW5hdGVzQnlDZW50ZXIoKSB7XG4gICAgY29uc3QgeyBvZmZzZXRIZWlnaHQsIG9mZnNldFdpZHRoIH0gPSB0aGlzLmVsZW1lbnQ7XG4gICAgY29uc3QgeSA9IG9mZnNldEhlaWdodCAvIDI7XG4gICAgY29uc3QgeCA9IG9mZnNldFdpZHRoIC8gMjtcblxuICAgIHJldHVybiB7IHgsIHkgfTtcbiAgfVxuXG4gIGdldENvb3JkaW5hdGVzQnlFdmVudChldmVudDogYW55KTogQ29vcmRpbmF0ZSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gdGhpcy5nZXRPZmZzZXQodGhpcy5lbGVtZW50KTtcblxuICAgIGNvbnN0IHkgPSBldmVudC5wYWdlWSAtIG9mZnNldC50b3A7XG4gICAgY29uc3QgeCA9IGV2ZW50LnBhZ2VYIC0gb2Zmc2V0LmxlZnQ7XG5cbiAgICByZXR1cm4geyB4LCB5IH07XG4gIH1cblxuICBnZXRSaXBwbGVSYWRpbyhjb29yZGluYXRlOiBDb29yZGluYXRlKTogbnVtYmVyIHtcbiAgICBjb25zdCBoZWlnaHQgPSBNYXRoLm1heCh0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gY29vcmRpbmF0ZS55LCBjb29yZGluYXRlLnkpO1xuICAgIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgodGhpcy5lbGVtZW50Lm9mZnNldFdpZHRoIC0gY29vcmRpbmF0ZS54LCBjb29yZGluYXRlLngpO1xuXG4gICAgY29uc3QgcmFkaW8gPSBNYXRoLmh5cG90KGhlaWdodCwgd2lkdGgpO1xuXG4gICAgcmV0dXJuIHJhZGlvO1xuICB9XG5cbiAgc2NhbGVSaXBwbGUocmlwcGxlOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgcmlwcGxlLnN0eWxlLnRyYW5zaXRpb25EdXJhdGlvbiA9IGAkeyB0aGlzLnJpcHBsZUR1cmF0aW9uIH1tc2A7XG4gICAgICByaXBwbGUuc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEpJztcblxuICAgICAgdGhpcy5oaWRlUmlwcGxlKHJpcHBsZSk7XG4gICAgfSwgMCk7XG4gIH1cblxuICBoaWRlUmlwcGxlKHJpcHBsZTogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUocmlwcGxlLCAndHJhbnNpdGlvbkR1cmF0aW9uJywgYCR7IHRoaXMucmlwcGxlRHVyYXRpb24gfW1zYCk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHJpcHBsZSwgJ29wYWNpdHknLCAnMCcpO1xuXG4gICAgICB0aGlzLnJlbW92ZVJpcHBsZShyaXBwbGUpO1xuICAgIH0sIHRoaXMucmlwcGxlRHVyYXRpb24pO1xuICB9XG5cbiAgcmVtb3ZlUmlwcGxlKHJpcHBsZTogSFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50LCByaXBwbGUpO1xuICAgIH0sIHRoaXMucmlwcGxlRHVyYXRpb24pO1xuICB9XG5cbiAgZ2V0T2Zmc2V0KGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XG4gICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgdG9wID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgfHwgMDtcbiAgICBjb25zdCBsZWZ0ID0gd2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCB8fCAwO1xuXG4gICAgY29uc3Qgb2Zmc2V0ID0ge1xuICAgICAgbGVmdDogcmVjdC5sZWZ0ICsgbGVmdCxcbiAgICAgIHRvcDogcmVjdC50b3AgKyB0b3BcbiAgICB9O1xuXG4gICAgcmV0dXJuIG9mZnNldDtcbiAgfVxufVxuIl19