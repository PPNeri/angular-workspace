/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @license
 * Copyright Workylab. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://raw.githubusercontent.com/workylab/materialize-angular/master/LICENSE
 */
import { Component, ContentChildren, ElementRef, EventEmitter, forwardRef, Input, Output, QueryList, Renderer2, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { supportedEvents, supportTouchEvents } from '../../utils/get-supported-events.util';
import { config } from '../../config';
import { SliderOptionComponent } from './slider-option/slider-option.component';
var SliderComponent = /** @class */ (function () {
    function SliderComponent(renderer) {
        this.renderer = renderer;
        this.className = SliderComponent.defaultProps.className;
        this.disabled = SliderComponent.defaultProps.disabled;
        this.required = SliderComponent.defaultProps.required;
        this.showLabels = SliderComponent.defaultProps.showLabels;
        this.showTicks = SliderComponent.defaultProps.showTicks;
        this.value = SliderComponent.defaultProps.value;
        this.prefix = config.components.prefix;
        this.isFocused = false;
        this.supportedEvents = supportedEvents();
        this.onChangeEmitter = new EventEmitter();
        this.actionDown = this.actionDown.bind(this);
        this.actionMove = this.actionMove.bind(this);
        this.actionUp = this.actionUp.bind(this);
        this.update = this.update.bind(this);
        window.addEventListener(this.supportedEvents.resize, this.update);
    }
    /**
     * @return {?}
     */
    SliderComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.sliderTrack.nativeElement.addEventListener(this.supportedEvents.down, this.actionDown);
    };
    /**
     * @return {?}
     */
    SliderComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        this.update();
        this.options.changes.subscribe(this.update);
    };
    /**
     * @return {?}
     */
    SliderComponent.prototype.update = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.renderPositions();
            _this.moveToValue(_this.value, false);
        }), 0);
    };
    /**
     * @return {?}
     */
    SliderComponent.prototype.renderPositions = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var pixelInterval = this.getPixelInterval();
        this.removeTicks();
        this.options.forEach((/**
         * @param {?} option
         * @param {?} index
         * @return {?}
         */
        function (option, index) {
            /** @type {?} */
            var leftSpace = pixelInterval * index;
            var nativeElement = option.templateRef.nativeElement;
            _this.renderer.setStyle(nativeElement, 'left', leftSpace + "px");
            if (_this.showTicks) {
                /** @type {?} */
                var tick = _this.renderer.createElement('div');
                _this.renderer.setStyle(tick, 'left', leftSpace + "px");
                _this.renderer.addClass(tick, SliderComponent.tickClassName);
                _this.renderer.appendChild(_this.sliderTrackInterval.nativeElement, tick);
            }
        }));
    };
    /**
     * @return {?}
     */
    SliderComponent.prototype.removeTicks = /**
     * @return {?}
     */
    function () {
        var nativeElement = this.sliderTrackInterval.nativeElement;
        while (nativeElement.firstChild) {
            this.renderer.removeChild(nativeElement, nativeElement.firstChild);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SliderComponent.prototype.actionDown = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.disabled) {
            /** @type {?} */
            var x = this.getXCoordinate(event, this.supportedEvents.down);
            this.animate(x, true);
            window.addEventListener(this.supportedEvents.up, this.actionUp);
            window.addEventListener(this.supportedEvents.move, this.actionMove);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SliderComponent.prototype.actionMove = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var x = this.getXCoordinate(event, this.supportedEvents.move);
        this.value = this.getValueFromXCoordinate(x);
        this.animate(x, false);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SliderComponent.prototype.actionUp = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        window.removeEventListener(this.supportedEvents.up, this.actionUp);
        window.removeEventListener(this.supportedEvents.move, this.actionMove);
        this.renderer.setStyle(this.sliderIndicatorContainer.nativeElement, 'transitionDuration', null);
        /** @type {?} */
        var x = this.getXCoordinate(event, this.supportedEvents.up);
        this.value = this.getValueFromXCoordinate(x);
        this.onChangeEmitter.emit(this.value);
        this.onChange(this.value);
        this.moveToValue(this.value, true);
    };
    /**
     * @param {?} value
     * @param {?} hasAnimation
     * @return {?}
     */
    SliderComponent.prototype.moveToValue = /**
     * @param {?} value
     * @param {?} hasAnimation
     * @return {?}
     */
    function (value, hasAnimation) {
        /** @type {?} */
        var options = this.options.toArray();
        /** @type {?} */
        var index = options.findIndex((/**
         * @param {?} option
         * @return {?}
         */
        function (option) { return option.value === value; }));
        /** @type {?} */
        var validatedIndex = index >= 0
            ? index
            : 0;
        /** @type {?} */
        var pixelInterval = this.getPixelInterval();
        /** @type {?} */
        var nextXCoordinate = validatedIndex * pixelInterval;
        this.animate(nextXCoordinate, hasAnimation);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    SliderComponent.prototype.activeOption = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.options.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            item.isActive = (item.value === value);
        }));
    };
    /**
     * @param {?} x
     * @return {?}
     */
    SliderComponent.prototype.getValueFromXCoordinate = /**
     * @param {?} x
     * @return {?}
     */
    function (x) {
        /** @type {?} */
        var index = this.getIndexFromXCoordinate(x);
        /** @type {?} */
        var options = this.options.toArray();
        /** @type {?} */
        var value = options[index].value;
        return value;
    };
    /**
     * @param {?} x
     * @return {?}
     */
    SliderComponent.prototype.getIndexFromXCoordinate = /**
     * @param {?} x
     * @return {?}
     */
    function (x) {
        /** @type {?} */
        var pixelInterval = this.getPixelInterval();
        if (pixelInterval) {
            /** @type {?} */
            var index = Math.round(x / pixelInterval);
            if (index >= 0 && index <= this.options.length) {
                return index;
            }
        }
        return 0;
    };
    /**
     * @param {?} event
     * @param {?} eventType
     * @return {?}
     */
    SliderComponent.prototype.getXCoordinateByEventType = /**
     * @param {?} event
     * @param {?} eventType
     * @return {?}
     */
    function (event, eventType) {
        if (supportTouchEvents()) {
            if (eventType === this.supportedEvents.up) {
                return event.changedTouches[0].clientX;
            }
            return event.touches[0].clientX;
        }
        return event.clientX;
    };
    /**
     * @param {?} event
     * @param {?} eventType
     * @return {?}
     */
    SliderComponent.prototype.getXCoordinate = /**
     * @param {?} event
     * @param {?} eventType
     * @return {?}
     */
    function (event, eventType) {
        /** @type {?} */
        var rect = this.sliderTrack.nativeElement.getBoundingClientRect();
        /** @type {?} */
        var xCoordinateEvent = this.getXCoordinateByEventType(event, eventType);
        /** @type {?} */
        var x = xCoordinateEvent - rect.left;
        if (x < 0) {
            return 0;
        }
        if (x > this.sliderTrack.nativeElement.offsetWidth) {
            return this.sliderTrack.nativeElement.offsetWidth;
        }
        return x;
    };
    /**
     * @return {?}
     */
    SliderComponent.prototype.getPixelInterval = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var maxOptionsSize = this.options.length - 1;
        if (maxOptionsSize > 0) {
            return this.sliderTrack.nativeElement.offsetWidth / maxOptionsSize;
        }
        return 0;
    };
    /**
     * @param {?} x
     * @param {?} hasAnimation
     * @return {?}
     */
    SliderComponent.prototype.animate = /**
     * @param {?} x
     * @param {?} hasAnimation
     * @return {?}
     */
    function (x, hasAnimation) {
        this.activeOption(this.value);
        /** @type {?} */
        var transitionDuration = hasAnimation
            ? null
            : '0ms';
        this.renderer.setStyle(this.sliderIndicatorContainer.nativeElement, 'transitionDuration', transitionDuration);
        this.renderer.setStyle(this.sliderIndicatorContainer.nativeElement, 'left', x + "px");
    };
    /**
     * @return {?}
     */
    SliderComponent.prototype.onFocus = /**
     * @return {?}
     */
    function () {
        if (!this.disabled) {
            this.isFocused = true;
            this.onTouched();
        }
    };
    /**
     * @return {?}
     */
    SliderComponent.prototype.onBlur = /**
     * @return {?}
     */
    function () {
        this.isFocused = false;
    };
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    SliderComponent.prototype.setDisabledState = /**
     * @param {?} isDisabled
     * @return {?}
     */
    function (isDisabled) {
        this.disabled = isDisabled;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    SliderComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.value = value;
            _this.moveToValue(value, false);
        }), 0);
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    SliderComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    SliderComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    SliderComponent.prototype.onChange = /**
     * @param {?} value
     * @return {?}
     */
    function (value) { };
    /**
     * @return {?}
     */
    SliderComponent.prototype.onTouched = /**
     * @return {?}
     */
    function () { };
    SliderComponent.tickClassName = config.components.prefix + '-slider-step';
    SliderComponent.defaultProps = {
        className: '',
        disabled: false,
        required: false,
        showLabels: true,
        showTicks: false,
        value: null
    };
    SliderComponent.decorators = [
        { type: Component, args: [{
                    providers: [{
                            multi: true,
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return SliderComponent; }))
                        }],
                    selector: config.components.prefix + "-slider }",
                    template: "<div [ngClass]=\"[prefix + '-slider', className]\" [class.focused]=\"isFocused\" [class.disabled]=\"disabled\">\n\n  <div [ngClass]=\"prefix + '-slider-track-container'\" #sliderTrack [tabindex]=\"disabled ? '-1' : '0'\" (focus)=\"onFocus()\" (blur)=\"onBlur()\">\n    <div #sliderTrackInterval></div>\n\n    <div [ngClass]=\"prefix + '-slider-track'\" #sliderTrackBackground></div>\n\n    <div [ngClass]=\"prefix + '-slider-indicator-container'\" #sliderIndicatorContainer>\n      <ng-content select=\"materialize-slider-indicator\"></ng-content>\n    </div>\n  </div>\n\n  <div [ngClass]=\"prefix + '-slider-labels-container'\" *ngIf=\"showLabels\">\n    <ng-content select=\"materialize-slider-option\"></ng-content>\n  </div>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    SliderComponent.ctorParameters = function () { return [
        { type: Renderer2 }
    ]; };
    SliderComponent.propDecorators = {
        options: [{ type: ContentChildren, args: [SliderOptionComponent,] }],
        Slider: [{ type: ViewChild, args: ['Slider', { static: true },] }],
        sliderIndicatorContainer: [{ type: ViewChild, args: ['sliderIndicatorContainer', { static: true },] }],
        sliderTrack: [{ type: ViewChild, args: ['sliderTrack', { static: true },] }],
        sliderTrackBackground: [{ type: ViewChild, args: ['sliderTrackBackground', { static: true },] }],
        sliderTrackInterval: [{ type: ViewChild, args: ['sliderTrackInterval', { static: true },] }],
        onChangeEmitter: [{ type: Output, args: ['onChange',] }],
        className: [{ type: Input }],
        disabled: [{ type: Input }],
        required: [{ type: Input }],
        showLabels: [{ type: Input }],
        showTicks: [{ type: Input }],
        value: [{ type: Input }]
    };
    return SliderComponent;
}());
export { SliderComponent };
if (false) {
    /** @type {?} */
    SliderComponent.tickClassName;
    /** @type {?} */
    SliderComponent.defaultProps;
    /** @type {?} */
    SliderComponent.prototype.options;
    /** @type {?} */
    SliderComponent.prototype.Slider;
    /** @type {?} */
    SliderComponent.prototype.sliderIndicatorContainer;
    /** @type {?} */
    SliderComponent.prototype.sliderTrack;
    /** @type {?} */
    SliderComponent.prototype.sliderTrackBackground;
    /** @type {?} */
    SliderComponent.prototype.sliderTrackInterval;
    /** @type {?} */
    SliderComponent.prototype.onChangeEmitter;
    /** @type {?} */
    SliderComponent.prototype.className;
    /** @type {?} */
    SliderComponent.prototype.disabled;
    /** @type {?} */
    SliderComponent.prototype.required;
    /** @type {?} */
    SliderComponent.prototype.showLabels;
    /** @type {?} */
    SliderComponent.prototype.showTicks;
    /** @type {?} */
    SliderComponent.prototype.value;
    /** @type {?} */
    SliderComponent.prototype.prefix;
    /** @type {?} */
    SliderComponent.prototype.isFocused;
    /** @type {?} */
    SliderComponent.prototype.supportedEvents;
    /**
     * @type {?}
     * @private
     */
    SliderComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21hdGVyaWFsaXplLWFuZ3VsYXIvIiwic291cmNlcyI6WyJhcHAvY29tcGxldGVkLWNvbXBvbmVudHMvc2xpZGVyL3NsaWRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBR0wsU0FBUyxFQUNULGVBQWUsRUFDZixVQUFVLEVBQ1YsWUFBWSxFQUNaLFVBQVUsRUFDVixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUsZUFBZSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDNUYsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUV0QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUdoRjtJQTJDRSx5QkFBb0IsUUFBbUI7UUFBbkIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQVo5QixjQUFTLEdBQVcsZUFBZSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUM7UUFDM0QsYUFBUSxHQUFZLGVBQWUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO1FBQzFELGFBQVEsR0FBWSxlQUFlLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztRQUMxRCxlQUFVLEdBQVksZUFBZSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUM7UUFDOUQsY0FBUyxHQUFZLGVBQWUsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDO1FBQzVELFVBQUssR0FBcUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUM7UUFFL0UsV0FBTSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBTXZDLElBQUksQ0FBQyxTQUFTLEdBQUcs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ZW5zZVxuICogQ29weXJpZ2h0IFdvcmt5bGFiLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS93b3JreWxhYi9tYXRlcmlhbGl6ZS1hbmd1bGFyL21hc3Rlci9MSUNFTlNFXG4gKi9cblxuaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgZm9yd2FyZFJlZixcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IHN1cHBvcnRlZEV2ZW50cywgc3VwcG9ydFRvdWNoRXZlbnRzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZ2V0LXN1cHBvcnRlZC1ldmVudHMudXRpbCc7XG5pbXBvcnQgeyBjb25maWcgfSBmcm9tICcuLi8uLi9jb25maWcnO1xuaW1wb3J0IHsgU2xpZGVyTW9kZWwgfSBmcm9tICcuL3NsaWRlci5tb2RlbCc7XG5pbXBvcnQgeyBTbGlkZXJPcHRpb25Db21wb25lbnQgfSBmcm9tICcuL3NsaWRlci1vcHRpb24vc2xpZGVyLW9wdGlvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgU3VwcG9ydGVkRXZlbnRzTW9kZWwgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL2NvbW1vbi9tb2RlbHMvc3VwcG9ydGVkLWV2ZW50cy5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBwcm92aWRlcnM6IFt7XG4gICAgbXVsdGk6IHRydWUsXG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU2xpZGVyQ29tcG9uZW50KVxuICB9XSxcbiAgc2VsZWN0b3I6IGAkeyBjb25maWcuY29tcG9uZW50cy5wcmVmaXggfS1zbGlkZXIgfWAsXG4gIHRlbXBsYXRlVXJsOiAnLi9zbGlkZXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFNsaWRlckNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIEFmdGVyVmlld0luaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBTbGlkZXJNb2RlbCB7XG4gIHN0YXRpYyByZWFkb25seSB0aWNrQ2xhc3NOYW1lID0gY29uZmlnLmNvbXBvbmVudHMucHJlZml4ICsgJy1zbGlkZXItc3RlcCc7XG5cbiAgc3RhdGljIHJlYWRvbmx5IGRlZmF1bHRQcm9wczogU2xpZGVyTW9kZWwgPSB7XG4gICAgY2xhc3NOYW1lOiAnJyxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIHNob3dMYWJlbHM6IHRydWUsXG4gICAgc2hvd1RpY2tzOiBmYWxzZSxcbiAgICB2YWx1ZTogbnVsbFxuICB9O1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oU2xpZGVyT3B0aW9uQ29tcG9uZW50KSBvcHRpb25zOiBRdWVyeUxpc3Q8U2xpZGVyT3B0aW9uQ29tcG9uZW50PjtcblxuICBAVmlld0NoaWxkKCdTbGlkZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBTbGlkZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3NsaWRlckluZGljYXRvckNvbnRhaW5lcicsIHsgc3RhdGljOiB0cnVlIH0pIHNsaWRlckluZGljYXRvckNvbnRhaW5lcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnc2xpZGVyVHJhY2snLCB7IHN0YXRpYzogdHJ1ZSB9KSBzbGlkZXJUcmFjazogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnc2xpZGVyVHJhY2tCYWNrZ3JvdW5kJywgeyBzdGF0aWM6IHRydWUgfSkgc2xpZGVyVHJhY2tCYWNrZ3JvdW5kOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdzbGlkZXJUcmFja0ludGVydmFsJywgeyBzdGF0aWM6IHRydWUgfSkgc2xpZGVyVHJhY2tJbnRlcnZhbDogRWxlbWVudFJlZjtcblxuICBAT3V0cHV0KCdvbkNoYW5nZScpIG9uQ2hhbmdlRW1pdHRlcjogRXZlbnRFbWl0dGVyPG51bWJlciB8IHN0cmluZyB8IGJvb2xlYW4gfCBudWxsPjtcblxuICBASW5wdXQoKSBjbGFzc05hbWU6IHN0cmluZyA9IFNsaWRlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMuY2xhc3NOYW1lO1xuICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbiA9IFNsaWRlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMuZGlzYWJsZWQ7XG4gIEBJbnB1dCgpIHJlcXVpcmVkOiBib29sZWFuID0gU2xpZGVyQ29tcG9uZW50LmRlZmF1bHRQcm9wcy5yZXF1aXJlZDtcbiAgQElucHV0KCkgc2hvd0xhYmVsczogYm9vbGVhbiA9IFNsaWRlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMuc2hvd0xhYmVscztcbiAgQElucHV0KCkgc2hvd1RpY2tzOiBib29sZWFuID0gU2xpZGVyQ29tcG9uZW50LmRlZmF1bHRQcm9wcy5zaG93VGlja3M7XG4gIEBJbnB1dCgpIHZhbHVlOiBudW1iZXIgfCBzdHJpbmcgfCBib29sZWFuIHwgbnVsbCA9IFNsaWRlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMudmFsdWU7XG5cbiAgcHVibGljIHByZWZpeCA9IGNvbmZpZy5jb21wb25lbnRzLnByZWZpeDtcblxuICBwdWJsaWMgaXNGb2N1c2VkOiBib29sZWFuO1xuICBwdWJsaWMgc3VwcG9ydGVkRXZlbnRzOiBTdXBwb3J0ZWRFdmVudHNNb2RlbDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICB0aGlzLmlzRm9jdXNlZCA9IGZhbHNlO1xuICAgIHRoaXMuc3VwcG9ydGVkRXZlbnRzID0gc3VwcG9ydGVkRXZlbnRzKCk7XG4gICAgdGhpcy5vbkNoYW5nZUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICB0aGlzLmFjdGlvbkRvd24gPSB0aGlzLmFjdGlvbkRvd24uYmluZCh0aGlzKTtcbiAgICB0aGlzLmFjdGlvbk1vdmUgPSB0aGlzLmFjdGlvbk1vdmUuYmluZCh0aGlzKTtcbiAgICB0aGlzLmFjdGlvblVwID0gdGhpcy5hY3Rpb25VcC5iaW5kKHRoaXMpO1xuICAgIHRoaXMudXBkYXRlID0gdGhpcy51cGRhdGUuYmluZCh0aGlzKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKHRoaXMuc3VwcG9ydGVkRXZlbnRzLnJlc2l6ZSwgdGhpcy51cGRhdGUpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuc2xpZGVyVHJhY2submF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKHRoaXMuc3VwcG9ydGVkRXZlbnRzLmRvd24sIHRoaXMuYWN0aW9uRG93bik7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy51cGRhdGUoKTtcblxuICAgIHRoaXMub3B0aW9ucy5jaGFuZ2VzLnN1YnNjcmliZSh0aGlzLnVwZGF0ZSk7XG4gIH1cblxuICB1cGRhdGUoKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnJlbmRlclBvc2l0aW9ucygpO1xuICAgICAgdGhpcy5tb3ZlVG9WYWx1ZSh0aGlzLnZhbHVlLCBmYWxzZSk7XG4gICAgfSwgMCk7XG4gIH1cblxuICByZW5kZXJQb3NpdGlvbnMoKSB7XG4gICAgY29uc3QgcGl4ZWxJbnRlcnZhbCA9IHRoaXMuZ2V0UGl4ZWxJbnRlcnZhbCgpO1xuXG4gICAgdGhpcy5yZW1vdmVUaWNrcygpO1xuXG4gICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGxlZnRTcGFjZSA9IHBpeGVsSW50ZXJ2YWwgKiBpbmRleDtcbiAgICAgIGNvbnN0IHsgbmF0aXZlRWxlbWVudCB9ID0gb3B0aW9uLnRlbXBsYXRlUmVmO1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKG5hdGl2ZUVsZW1lbnQsICdsZWZ0JywgYCR7IGxlZnRTcGFjZSB9cHhgKTtcblxuICAgICAgaWYgKHRoaXMuc2hvd1RpY2tzKSB7XG4gICAgICAgIGNvbnN0IHRpY2sgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGljaywgJ2xlZnQnLCBgJHsgbGVmdFNwYWNlIH1weGApO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRpY2ssIFNsaWRlckNvbXBvbmVudC50aWNrQ2xhc3NOYW1lKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnNsaWRlclRyYWNrSW50ZXJ2YWwubmF0aXZlRWxlbWVudCwgdGljayk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZW1vdmVUaWNrcygpIHtcbiAgICBjb25zdCB7IG5hdGl2ZUVsZW1lbnQgfSA9IHRoaXMuc2xpZGVyVHJhY2tJbnRlcnZhbDtcblxuICAgIHdoaWxlIChuYXRpdmVFbGVtZW50LmZpcnN0Q2hpbGQpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2hpbGQobmF0aXZlRWxlbWVudCwgbmF0aXZlRWxlbWVudC5maXJzdENoaWxkKTtcbiAgICB9XG4gIH1cblxuICBhY3Rpb25Eb3duKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIGNvbnN0IHggPSB0aGlzLmdldFhDb29yZGluYXRlKGV2ZW50LCB0aGlzLnN1cHBvcnRlZEV2ZW50cy5kb3duKTtcblxuICAgICAgdGhpcy5hbmltYXRlKHgsIHRydWUpO1xuXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnN1cHBvcnRlZEV2ZW50cy51cCwgdGhpcy5hY3Rpb25VcCk7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnN1cHBvcnRlZEV2ZW50cy5tb3ZlLCB0aGlzLmFjdGlvbk1vdmUpO1xuICAgIH1cbiAgfVxuXG4gIGFjdGlvbk1vdmUoZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IHggPSB0aGlzLmdldFhDb29yZGluYXRlKGV2ZW50LCB0aGlzLnN1cHBvcnRlZEV2ZW50cy5tb3ZlKTtcblxuICAgIHRoaXMudmFsdWUgPSB0aGlzLmdldFZhbHVlRnJvbVhDb29yZGluYXRlKHgpO1xuICAgIHRoaXMuYW5pbWF0ZSh4LCBmYWxzZSk7XG4gIH1cblxuICBhY3Rpb25VcChldmVudDogYW55KSB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5zdXBwb3J0ZWRFdmVudHMudXAsIHRoaXMuYWN0aW9uVXApO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuc3VwcG9ydGVkRXZlbnRzLm1vdmUsIHRoaXMuYWN0aW9uTW92ZSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuc2xpZGVySW5kaWNhdG9yQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICd0cmFuc2l0aW9uRHVyYXRpb24nLCBudWxsKTtcblxuICAgIGNvbnN0IHggPSB0aGlzLmdldFhDb29yZGluYXRlKGV2ZW50LCB0aGlzLnN1cHBvcnRlZEV2ZW50cy51cCk7XG5cbiAgICB0aGlzLnZhbHVlID0gdGhpcy5nZXRWYWx1ZUZyb21YQ29vcmRpbmF0ZSh4KTtcbiAgICB0aGlzLm9uQ2hhbmdlRW1pdHRlci5lbWl0KHRoaXMudmFsdWUpO1xuICAgIHRoaXMub25DaGFuZ2UodGhpcy52YWx1ZSk7XG4gICAgdGhpcy5tb3ZlVG9WYWx1ZSh0aGlzLnZhbHVlLCB0cnVlKTtcbiAgfVxuXG4gIG1vdmVUb1ZhbHVlKHZhbHVlOiBudW1iZXIgfCBzdHJpbmcgfCBib29sZWFuIHwgbnVsbCwgaGFzQW5pbWF0aW9uOiBib29sZWFuKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucy50b0FycmF5KCk7XG4gICAgY29uc3QgaW5kZXggPSBvcHRpb25zLmZpbmRJbmRleChvcHRpb24gPT4gb3B0aW9uLnZhbHVlID09PSB2YWx1ZSk7XG4gICAgY29uc3QgdmFsaWRhdGVkSW5kZXggPSBpbmRleCA+PSAwXG4gICAgICA/IGluZGV4XG4gICAgICA6IDA7XG4gICAgY29uc3QgcGl4ZWxJbnRlcnZhbCA9IHRoaXMuZ2V0UGl4ZWxJbnRlcnZhbCgpO1xuICAgIGNvbnN0IG5leHRYQ29vcmRpbmF0ZSA9IHZhbGlkYXRlZEluZGV4ICogcGl4ZWxJbnRlcnZhbDtcblxuICAgIHRoaXMuYW5pbWF0ZShuZXh0WENvb3JkaW5hdGUsIGhhc0FuaW1hdGlvbik7XG4gIH1cblxuICBhY3RpdmVPcHRpb24odmFsdWU6IG51bWJlciB8IHN0cmluZyB8IGJvb2xlYW4gfCBudWxsKSB7XG4gICAgdGhpcy5vcHRpb25zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBpdGVtLmlzQWN0aXZlID0gKGl0ZW0udmFsdWUgPT09IHZhbHVlKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFZhbHVlRnJvbVhDb29yZGluYXRlKHg6IG51bWJlcikge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5nZXRJbmRleEZyb21YQ29vcmRpbmF0ZSh4KTtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5vcHRpb25zLnRvQXJyYXkoKTtcbiAgICBjb25zdCB2YWx1ZSA9IG9wdGlvbnNbaW5kZXhdLnZhbHVlO1xuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgZ2V0SW5kZXhGcm9tWENvb3JkaW5hdGUoeDogbnVtYmVyKSB7XG4gICAgY29uc3QgcGl4ZWxJbnRlcnZhbCA9IHRoaXMuZ2V0UGl4ZWxJbnRlcnZhbCgpO1xuXG4gICAgaWYgKHBpeGVsSW50ZXJ2YWwpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5yb3VuZCh4IC8gcGl4ZWxJbnRlcnZhbCk7XG5cbiAgICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDw9IHRoaXMub3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAwO1xuICB9XG5cbiAgZ2V0WENvb3JkaW5hdGVCeUV2ZW50VHlwZShldmVudDogYW55LCBldmVudFR5cGU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgaWYgKHN1cHBvcnRUb3VjaEV2ZW50cygpKSB7XG4gICAgICBpZiAoZXZlbnRUeXBlID09PSB0aGlzLnN1cHBvcnRlZEV2ZW50cy51cCkge1xuICAgICAgICByZXR1cm4gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICB9XG5cbiAgICByZXR1cm4gZXZlbnQuY2xpZW50WDtcbiAgfVxuXG4gIGdldFhDb29yZGluYXRlKGV2ZW50OiBhbnksIGV2ZW50VHlwZTogc3RyaW5nKSB7XG4gICAgY29uc3QgcmVjdCA9IHRoaXMuc2xpZGVyVHJhY2submF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCB4Q29vcmRpbmF0ZUV2ZW50ID0gdGhpcy5nZXRYQ29vcmRpbmF0ZUJ5RXZlbnRUeXBlKGV2ZW50LCBldmVudFR5cGUpO1xuICAgIGNvbnN0IHggPSB4Q29vcmRpbmF0ZUV2ZW50IC0gcmVjdC5sZWZ0O1xuXG4gICAgaWYgKHggPCAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBpZiAoeCA+IHRoaXMuc2xpZGVyVHJhY2submF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2xpZGVyVHJhY2submF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICB9XG5cbiAgICByZXR1cm4geDtcbiAgfVxuXG4gIGdldFBpeGVsSW50ZXJ2YWwoKSB7XG4gICAgY29uc3QgbWF4T3B0aW9uc1NpemUgPSB0aGlzLm9wdGlvbnMubGVuZ3RoIC0gMTtcblxuICAgIGlmIChtYXhPcHRpb25zU2l6ZSA+IDApIHtcbiAgICAgIHJldHVybiB0aGlzLnNsaWRlclRyYWNrLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLyBtYXhPcHRpb25zU2l6ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGFuaW1hdGUoeDogbnVtYmVyLCBoYXNBbmltYXRpb246IGJvb2xlYW4pIHtcbiAgICB0aGlzLmFjdGl2ZU9wdGlvbih0aGlzLnZhbHVlKTtcblxuICAgIGNvbnN0IHRyYW5zaXRpb25EdXJhdGlvbiA9IGhhc0FuaW1hdGlvblxuICAgICAgPyBudWxsXG4gICAgICA6ICcwbXMnO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnNsaWRlckluZGljYXRvckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCAndHJhbnNpdGlvbkR1cmF0aW9uJywgdHJhbnNpdGlvbkR1cmF0aW9uKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuc2xpZGVySW5kaWNhdG9yQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdsZWZ0JywgYCR7IHggfXB4YCk7XG4gIH1cblxuICBvbkZvY3VzKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xuICAgICAgdGhpcy5pc0ZvY3VzZWQgPSB0cnVlO1xuXG4gICAgICB0aGlzLm9uVG91Y2hlZCgpO1xuICAgIH1cbiAgfVxuXG4gIG9uQmx1cigpOiB2b2lkIHtcbiAgICB0aGlzLmlzRm9jdXNlZCA9IGZhbHNlO1xuICB9XG5cbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBudW1iZXIgfCBzdHJpbmcgfCBib29sZWFuIHwgbnVsbCk6IHZvaWQge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuXG4gICAgICB0aGlzLm1vdmVUb1ZhbHVlKHZhbHVlLCBmYWxzZSk7XG4gICAgfSwgMCk7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAodmFsdWU6IG51bWJlciB8IHN0cmluZyB8IGJvb2xlYW4gfCBudWxsKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG91Y2hlZCA9IGZuO1xuICB9XG5cbiAgb25DaGFuZ2UodmFsdWU6IG51bWJlciB8IHN0cmluZyB8IGJvb2xlYW4gfCBudWxsKTogdm9pZCB7fVxuXG4gIG9uVG91Y2hlZCgpOiB2b2lkIHt9XG59XG4iXX0=