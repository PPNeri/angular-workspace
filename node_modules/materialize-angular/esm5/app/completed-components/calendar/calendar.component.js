/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @license
 * Copyright Workylab. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://raw.githubusercontent.com/workylab/materialize-angular/master/LICENSE
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { config } from '../../config';
import { days } from '../../fixtures/calendar-week-days';
import { months } from '../../fixtures/calendar-months';
var CalendarComponent = /** @class */ (function () {
    function CalendarComponent() {
        this.className = CalendarComponent.defaultProps.className;
        this.date = CalendarComponent.defaultProps.date;
        this.displayOtherMonthDays = CalendarComponent.defaultProps.displayOtherMonthDays;
        this.prefix = config.components.prefix;
        this.selectYearAnimationDuration = 150;
        this.scrollToActiveYear = this.scrollToActiveYear.bind(this);
        this.onSelectDayEmitter = new EventEmitter();
        this.dayLabels = this.getDayLabels(days);
        this.monthLabels = this.getMonthLabels(months);
    }
    /**
     * @return {?}
     */
    CalendarComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.init();
    };
    /**
     * @return {?}
     */
    CalendarComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        this.init();
    };
    /**
     * @return {?}
     */
    CalendarComponent.prototype.init = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var dateExists = (typeof this.date !== 'undefined' && this.date !== null);
        /** @type {?} */
        var openDate = dateExists ? this.date : new Date();
        /** @type {?} */
        var isToday = this.isTodayDate(openDate);
        /** @type {?} */
        var month = openDate.getMonth();
        /** @type {?} */
        var year = openDate.getFullYear();
        this.weeks = this.fillWeeks(month, year);
        this.years = this.fillYears(year);
        this.selectedDate = this.createDateModel(openDate, false, isToday, dateExists);
    };
    /**
     * @param {?} dayLabels
     * @return {?}
     */
    CalendarComponent.prototype.getDayLabels = /**
     * @param {?} dayLabels
     * @return {?}
     */
    function (dayLabels) {
        return [
            dayLabels.sunday,
            dayLabels.monday,
            dayLabels.tuesday,
            dayLabels.wednesday,
            dayLabels.thursday,
            dayLabels.friday,
            dayLabels.saturday
        ];
    };
    /**
     * @param {?} monthLabels
     * @return {?}
     */
    CalendarComponent.prototype.getMonthLabels = /**
     * @param {?} monthLabels
     * @return {?}
     */
    function (monthLabels) {
        return [
            monthLabels.january,
            monthLabels.february,
            monthLabels.march,
            monthLabels.april,
            monthLabels.may,
            monthLabels.june,
            monthLabels.july,
            monthLabels.august,
            monthLabels.september,
            monthLabels.october,
            monthLabels.november,
            monthLabels.december
        ];
    };
    /**
     * @param {?} date
     * @param {?} isOutOfMonth
     * @param {?} isToday
     * @param {?} showSelected
     * @return {?}
     */
    CalendarComponent.prototype.createDateModel = /**
     * @param {?} date
     * @param {?} isOutOfMonth
     * @param {?} isToday
     * @param {?} showSelected
     * @return {?}
     */
    function (date, isOutOfMonth, isToday, showSelected) {
        /** @type {?} */
        var weekDay = date.getDay();
        /** @type {?} */
        var month = date.getMonth();
        /** @type {?} */
        var dateModel = {
            ISODate: this.generateISODate(date),
            date: date,
            dayLabel: this.dayLabels[weekDay],
            isOutOfMonth: isOutOfMonth,
            isToday: isToday,
            monthLabel: this.monthLabels[month],
            showSelected: showSelected
        };
        return dateModel;
    };
    /**
     * @param {?} day
     * @param {?} month
     * @param {?} year
     * @return {?}
     */
    CalendarComponent.prototype.createDateObject = /**
     * @param {?} day
     * @param {?} month
     * @param {?} year
     * @return {?}
     */
    function (day, month, year) {
        /** @type {?} */
        var date = new Date();
        date.setDate(day);
        date.setMonth(month);
        date.setFullYear(year);
        return date;
    };
    /**
     * @param {?} currentYear
     * @return {?}
     */
    CalendarComponent.prototype.fillYears = /**
     * @param {?} currentYear
     * @return {?}
     */
    function (currentYear) {
        /** @type {?} */
        var firstYear = currentYear - 100;
        /** @type {?} */
        var lastYear = currentYear + 100;
        /** @type {?} */
        var years = [];
        for (var i = firstYear; i <= lastYear; i++) {
            years.push(i);
        }
        return years;
    };
    /**
     * @param {?} month
     * @param {?} year
     * @return {?}
     */
    CalendarComponent.prototype.fillWeeks = /**
     * @param {?} month
     * @param {?} year
     * @return {?}
     */
    function (month, year) {
        this.selectedMonth = {
            label: this.monthLabels[month],
            number: month,
            year: year
        };
        /** @type {?} */
        var finalMonthDay = this.createDateObject(0, month, year);
        /** @type {?} */
        var weeks = [];
        /** @type {?} */
        var initMonthDate = new Date(year, month, 1);
        /** @type {?} */
        var day = 0 - initMonthDate.getDay();
        /** @type {?} */
        var daysInWeek = [];
        while (initMonthDate.getDay() !== 0 || finalMonthDay >= initMonthDate) {
            ++day;
            initMonthDate = new Date(year, month, day);
            daysInWeek.push(this.createDayDate(initMonthDate, day, finalMonthDay));
            if (daysInWeek.length === 7) {
                weeks.push(daysInWeek);
                daysInWeek = [];
            }
        }
        return weeks;
    };
    /**
     * @param {?} date
     * @return {?}
     */
    CalendarComponent.prototype.isTodayDate = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        /** @type {?} */
        var ISOCurrentDate = this.generateISODate(new Date());
        /** @type {?} */
        var ISODate = this.generateISODate(date);
        /** @type {?} */
        var isToday = (ISODate === ISOCurrentDate);
        return isToday;
    };
    /**
     * @param {?} date
     * @param {?} dayNumber
     * @param {?} finalMonthDay
     * @return {?}
     */
    CalendarComponent.prototype.createDayDate = /**
     * @param {?} date
     * @param {?} dayNumber
     * @param {?} finalMonthDay
     * @return {?}
     */
    function (date, dayNumber, finalMonthDay) {
        /** @type {?} */
        var isToday = this.isTodayDate(date);
        /** @type {?} */
        var isOutOfMonth = (dayNumber <= 0 || date > finalMonthDay);
        return this.createDateModel(date, isOutOfMonth, isToday, true);
    };
    /**
     * @return {?}
     */
    CalendarComponent.prototype.showPrevMonth = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var month = this.selectedMonth.number;
        /** @type {?} */
        var year = this.selectedMonth.year;
        /** @type {?} */
        var prevMonth = month >= 1
            ? month - 1
            : 11;
        /** @type {?} */
        var prevYear = month < 1
            ? year - 1
            : year;
        this.weeks = this.fillWeeks(prevMonth, prevYear);
    };
    /**
     * @return {?}
     */
    CalendarComponent.prototype.showNextMonth = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var month = this.selectedMonth.number;
        /** @type {?} */
        var year = this.selectedMonth.year;
        /** @type {?} */
        var nextMonth = month < 11
            ? month + 1
            : 0;
        /** @type {?} */
        var nextYear = month >= 11
            ? year + 1
            : year;
        this.weeks = this.fillWeeks(nextMonth, nextYear);
    };
    /**
     * @param {?} date
     * @return {?}
     */
    CalendarComponent.prototype.generateISODate = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        /** @type {?} */
        var day = date.getDate();
        /** @type {?} */
        var month = date.getMonth() + 1;
        /** @type {?} */
        var year = date.getFullYear();
        /** @type {?} */
        var dayString = day > 9
            ? day
            : "0" + day;
        /** @type {?} */
        var monthString = month > 9
            ? month
            : "0" + month;
        return year + "-" + monthString + "-" + dayString;
    };
    /**
     * @param {?} date
     * @return {?}
     */
    CalendarComponent.prototype.onSelectDay = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        if (date.isOutOfMonth) {
            return;
        }
        this.selectedDate = date;
        this.onSelectDayEmitter.emit(this.selectedDate);
    };
    /**
     * @param {?} year
     * @return {?}
     */
    CalendarComponent.prototype.onSelectYear = /**
     * @param {?} year
     * @return {?}
     */
    function (year) {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var day = _this.selectedDate.date.getDate();
            /** @type {?} */
            var month = _this.selectedDate.date.getMonth();
            _this.date = _this.createDateObject(day, month, year);
            _this.showYears = false;
            _this.selectedDate = _this.createDateModel(_this.date, false, true, true);
            _this.weeks = _this.fillWeeks(month, year);
        }), this.selectYearAnimationDuration);
    };
    /**
     * @return {?}
     */
    CalendarComponent.prototype.displayYears = /**
     * @return {?}
     */
    function () {
        this.showYears = true;
        setTimeout(this.scrollToActiveYear, 0);
    };
    /**
     * @return {?}
     */
    CalendarComponent.prototype.scrollToActiveYear = /**
     * @return {?}
     */
    function () {
        var nativeElement = this.yearsContainerRef.nativeElement;
        /** @type {?} */
        var activeYear = nativeElement.querySelector('.selected');
        if (activeYear) {
            /** @type {?} */
            var top_1 = this.getScrollCenter(nativeElement, activeYear);
            nativeElement.scrollTop = top_1;
        }
    };
    /**
     * @param {?} container
     * @param {?} internalElement
     * @return {?}
     */
    CalendarComponent.prototype.getScrollCenter = /**
     * @param {?} container
     * @param {?} internalElement
     * @return {?}
     */
    function (container, internalElement) {
        /** @type {?} */
        var yearTop = internalElement.offsetTop;
        /** @type {?} */
        var yearMiddleHeight = internalElement.offsetHeight / 2;
        /** @type {?} */
        var containerTop = container.offsetTop;
        /** @type {?} */
        var containerMiddleHeight = container.offsetHeight / 2;
        /** @type {?} */
        var elementRelativeTop = (yearTop - containerTop) - (containerMiddleHeight - yearMiddleHeight);
        if (elementRelativeTop < 0) {
            return 0;
        }
        return elementRelativeTop;
    };
    CalendarComponent.defaultProps = {
        className: '',
        date: new Date(),
        displayOtherMonthDays: true
    };
    CalendarComponent.decorators = [
        { type: Component, args: [{
                    selector: config.components.prefix + "-calendar }",
                    template: "<div [ngClass]=\"[prefix + '-calendar', className]\">\n  <div [ngClass]=\"prefix + '-calendar-header'\">\n    <div [ngClass]=\"prefix + '-calendar-year'\">\n      <materialize-button (onClick)=\"displayYears()\">{{ selectedMonth.year }}</materialize-button>\n    </div>\n    <div [ngClass]=\"prefix + '-calendar-date'\">\n      <materialize-button (onClick)=\"showYears = false\">\n        {{ selectedDate.dayLabel.shortName }}, {{ selectedDate.monthLabel.shortName }} {{ selectedDate.date.getDate() }}\n      </materialize-button>\n    </div>\n  </div>\n\n  <div [ngClass]=\"prefix + '-calendar-body'\">\n    <ng-container *ngIf=\"!showYears\">\n      <div [ngClass]=\"prefix + '-calendar-controls'\">\n        <div [ngClass]=\"prefix + '-calendar-control'\" materializeRipple (click)=\"showPrevMonth()\">\n          <materialize-icon>chevron_left</materialize-icon>\n        </div>\n        <div [ngClass]=\"prefix + '-calendar-month'\">\n          {{ selectedMonth.label.shortName }} {{ selectedMonth.year }}\n        </div>\n        <div [ngClass]=\"prefix + '-calendar-control'\" materializeRipple (click)=\"showNextMonth()\">\n          <materialize-icon>chevron_right</materialize-icon>\n        </div>\n      </div>\n      \n      <table [ngClass]=\"prefix + '-calendar-table'\">\n        <thead>\n          <tr>\n            <td [ngClass]=\"prefix + '-calendar-day-name'\" *ngFor=\"let day of dayLabels\">{{ day.shortestName }}</td>\n          </tr>\n        </thead>\n        <tbody>\n          <tr *ngFor=\"let week of weeks\">\n            <td *ngFor=\"let day of week\">\n              <div [ngClass]=\"prefix + '-calendar-day'\"\n                (click)=\"onSelectDay(day)\"\n                *ngIf=\"!day.isOutOfMonth || displayOtherMonthDays\"\n  \n                [class.current]=\"day.isToday\"\n                [class.selected]=\"selectedDate.showSelected && selectedDate.ISODate === day.ISODate\"\n                [class.disabled]=\"day.isOutOfMonth\"\n  \n                materializeRipple\n                [rippleDuration]=\"800\"\n              >\n                {{ day.date.getDate() }}\n              </div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </ng-container>\n    \n    <div [ngClass]=\"prefix + '-calendar-years'\"  #yearsContainer>\n      <ng-container *ngIf=\"showYears\">\n        <div [ngClass]=\"prefix + '-calendar-year-option'\"\n          *ngFor=\"let year of years\"\n\n          (click)=\"onSelectYear(year)\"\n          [class.selected]=\"year === selectedMonth.year\"\n\n          materializeRipple\n          [rippleDuration]=\"selectYearAnimationDuration\"\n        >\n          {{ year }}\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    CalendarComponent.ctorParameters = function () { return []; };
    CalendarComponent.propDecorators = {
        yearsContainerRef: [{ type: ViewChild, args: ['yearsContainer', { static: false },] }],
        onSelectDayEmitter: [{ type: Output, args: ['onSelectDay',] }],
        className: [{ type: Input }],
        date: [{ type: Input }],
        displayOtherMonthDays: [{ type: Input }]
    };
    return CalendarComponent;
}());
export { CalendarComponent };
if (false) {
    /** @type {?} */
    CalendarComponent.defaultProps;
    /** @type {?} */
    CalendarComponent.prototype.yearsContainerRef;
    /** @type {?} */
    CalendarComponent.prototype.onSelectDayEmitter;
    /** @type {?} */
    CalendarComponent.prototype.className;
    /** @type {?} */
    CalendarComponent.prototype.date;
    /** @type {?} */
    CalendarComponent.prototype.displayOtherMonthDays;
    /** @type {?} */
    CalendarComponent.prototype.prefix;
    /** @type {?} */
    CalendarComponent.prototype.dayLabels;
    /** @type {?} */
    CalendarComponent.prototype.monthLabels;
    /** @type {?} */
    CalendarComponent.prototype.selectedDate;
    /** @type {?} */
    CalendarComponent.prototype.selectedMonth;
    /** @type {?} */
    CalendarComponent.prototype.showYears;
    /** @type {?} */
    CalendarComponent.prototype.weeks;
    /** @type {?} */
    CalendarComponent.prototype.years;
    /** @type {?} */
    CalendarComponent.prototype.selectYearAnimationDuration;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWF0ZXJpYWxpemUtYW5ndWxhci8iLCJzb3VyY2VzIjpbImFwcC9jb21wbGV0ZWQtY29tcG9uZW50cy9jYWxlbmRhci9jYWxlbmRhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFTQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pILE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDdEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3pELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUV4RDtJQStCRTtRQWhCUyxjQUFTLEdBQVcsaUJBQWlCLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQztRQUM3RCxTQUFJLEdBQVMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQztRQUNqRCwwQkFBcUIsR0FBWSxpQkFBaUIsQ0FBQyxZQUFZLENBQUMscUJBQXFCLENBQUM7UUFFeEYsV0FBTSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBVWxDLGdDQUEyQixHQUFHLEdBQUcsQ0FBQztRQUd2QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU3RCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxZQUFZLEVBQWEsQ0FBQztRQUV4RCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pELENBQUM7Ozs7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bUM7O0lBQ25DLHdDQUFxQzs7SUFDckMseUNBQStCOztJQUMvQiwwQ0FBaUM7O0lBQ2pDLHNDQUEwQjs7SUFDMUIsa0NBQXNDOztJQUN0QyxrQ0FBNEI7O0lBRTVCLHdEQUF5QyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBXb3JreWxhYi4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vd29ya3lsYWIvbWF0ZXJpYWxpemUtYW5ndWxhci9tYXN0ZXIvTElDRU5TRVxuICovXG5cbmltcG9ydCB7IENhbGVuZGFyTW9kZWwsIERhdGVMYWJlbCwgRGF0ZU1vZGVsLCBEYXlMYWJlbHMsIE1vbnRoTGFiZWxzLCBNb250aE1vZGVsIH0gZnJvbSAnLi9jYWxlbmRhci5tb2RlbCc7XG5pbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnLi4vLi4vY29uZmlnJztcbmltcG9ydCB7IGRheXMgfSBmcm9tICcuLi8uLi9maXh0dXJlcy9jYWxlbmRhci13ZWVrLWRheXMnO1xuaW1wb3J0IHsgbW9udGhzIH0gZnJvbSAnLi4vLi4vZml4dHVyZXMvY2FsZW5kYXItbW9udGhzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBgJHsgY29uZmlnLmNvbXBvbmVudHMucHJlZml4IH0tY2FsZW5kYXIgfWAsXG4gIHRlbXBsYXRlVXJsOiAnLi9jYWxlbmRhci5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQ2FsZW5kYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIHN0YXRpYyByZWFkb25seSBkZWZhdWx0UHJvcHM6IENhbGVuZGFyTW9kZWwgPSB7XG4gICAgY2xhc3NOYW1lOiAnJyxcbiAgICBkYXRlOiBuZXcgRGF0ZSgpLFxuICAgIGRpc3BsYXlPdGhlck1vbnRoRGF5czogdHJ1ZVxuICB9O1xuXG4gIEBWaWV3Q2hpbGQoJ3llYXJzQ29udGFpbmVyJywgeyBzdGF0aWM6IGZhbHNlIH0pIHllYXJzQ29udGFpbmVyUmVmOiBFbGVtZW50UmVmO1xuXG4gIEBPdXRwdXQoJ29uU2VsZWN0RGF5Jykgb25TZWxlY3REYXlFbWl0dGVyOiBFdmVudEVtaXR0ZXI8RGF0ZU1vZGVsPjtcblxuICBASW5wdXQoKSBjbGFzc05hbWU6IHN0cmluZyA9IENhbGVuZGFyQ29tcG9uZW50LmRlZmF1bHRQcm9wcy5jbGFzc05hbWU7XG4gIEBJbnB1dCgpIGRhdGU6IERhdGUgPSBDYWxlbmRhckNvbXBvbmVudC5kZWZhdWx0UHJvcHMuZGF0ZTtcbiAgQElucHV0KCkgZGlzcGxheU90aGVyTW9udGhEYXlzOiBib29sZWFuID0gQ2FsZW5kYXJDb21wb25lbnQuZGVmYXVsdFByb3BzLmRpc3BsYXlPdGhlck1vbnRoRGF5cztcblxuICBwdWJsaWMgcHJlZml4ID0gY29uZmlnLmNvbXBvbmVudHMucHJlZml4O1xuXG4gIHB1YmxpYyBkYXlMYWJlbHM6IEFycmF5PERhdGVMYWJlbD47XG4gIHB1YmxpYyBtb250aExhYmVsczogQXJyYXk8RGF0ZUxhYmVsPjtcbiAgcHVibGljIHNlbGVjdGVkRGF0ZTogRGF0ZU1vZGVsO1xuICBwdWJsaWMgc2VsZWN0ZWRNb250aDogTW9udGhNb2RlbDtcbiAgcHVibGljIHNob3dZZWFyczogYm9vbGVhbjtcbiAgcHVibGljIHdlZWtzOiBBcnJheTxBcnJheTxEYXRlTW9kZWw+PjtcbiAgcHVibGljIHllYXJzOiBBcnJheTxudW1iZXI+O1xuXG4gIHB1YmxpYyBzZWxlY3RZZWFyQW5pbWF0aW9uRHVyYXRpb24gPSAxNTA7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zY3JvbGxUb0FjdGl2ZVllYXIgPSB0aGlzLnNjcm9sbFRvQWN0aXZlWWVhci5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5vblNlbGVjdERheUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGVNb2RlbD4oKTtcblxuICAgIHRoaXMuZGF5TGFiZWxzID0gdGhpcy5nZXREYXlMYWJlbHMoZGF5cyk7XG4gICAgdGhpcy5tb250aExhYmVscyA9IHRoaXMuZ2V0TW9udGhMYWJlbHMobW9udGhzKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgdGhpcy5pbml0KCk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIGNvbnN0IGRhdGVFeGlzdHMgPSAodHlwZW9mIHRoaXMuZGF0ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdGhpcy5kYXRlICE9PSBudWxsKTtcbiAgICBjb25zdCBvcGVuRGF0ZSA9IGRhdGVFeGlzdHMgPyB0aGlzLmRhdGUgOiBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGlzVG9kYXkgPSB0aGlzLmlzVG9kYXlEYXRlKG9wZW5EYXRlKTtcbiAgICBjb25zdCBtb250aCA9IG9wZW5EYXRlLmdldE1vbnRoKCk7XG4gICAgY29uc3QgeWVhciA9IG9wZW5EYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICB0aGlzLndlZWtzID0gdGhpcy5maWxsV2Vla3MobW9udGgsIHllYXIpO1xuICAgIHRoaXMueWVhcnMgPSB0aGlzLmZpbGxZZWFycyh5ZWFyKTtcblxuICAgIHRoaXMuc2VsZWN0ZWREYXRlID0gdGhpcy5jcmVhdGVEYXRlTW9kZWwob3BlbkRhdGUsIGZhbHNlLCBpc1RvZGF5LCBkYXRlRXhpc3RzKTtcbiAgfVxuXG4gIGdldERheUxhYmVscyhkYXlMYWJlbHM6IERheUxhYmVscyk6IEFycmF5PERhdGVMYWJlbD4ge1xuICAgIHJldHVybiBbXG4gICAgICBkYXlMYWJlbHMuc3VuZGF5LFxuICAgICAgZGF5TGFiZWxzLm1vbmRheSxcbiAgICAgIGRheUxhYmVscy50dWVzZGF5LFxuICAgICAgZGF5TGFiZWxzLndlZG5lc2RheSxcbiAgICAgIGRheUxhYmVscy50aHVyc2RheSxcbiAgICAgIGRheUxhYmVscy5mcmlkYXksXG4gICAgICBkYXlMYWJlbHMuc2F0dXJkYXlcbiAgICBdO1xuICB9XG5cbiAgZ2V0TW9udGhMYWJlbHMobW9udGhMYWJlbHM6IE1vbnRoTGFiZWxzKTogQXJyYXk8RGF0ZUxhYmVsPiB7XG4gICAgcmV0dXJuIFtcbiAgICAgIG1vbnRoTGFiZWxzLmphbnVhcnksXG4gICAgICBtb250aExhYmVscy5mZWJydWFyeSxcbiAgICAgIG1vbnRoTGFiZWxzLm1hcmNoLFxuICAgICAgbW9udGhMYWJlbHMuYXByaWwsXG4gICAgICBtb250aExhYmVscy5tYXksXG4gICAgICBtb250aExhYmVscy5qdW5lLFxuICAgICAgbW9udGhMYWJlbHMuanVseSxcbiAgICAgIG1vbnRoTGFiZWxzLmF1Z3VzdCxcbiAgICAgIG1vbnRoTGFiZWxzLnNlcHRlbWJlcixcbiAgICAgIG1vbnRoTGFiZWxzLm9jdG9iZXIsXG4gICAgICBtb250aExhYmVscy5ub3ZlbWJlcixcbiAgICAgIG1vbnRoTGFiZWxzLmRlY2VtYmVyXG4gICAgXTtcbiAgfVxuXG4gIGNyZWF0ZURhdGVNb2RlbChkYXRlOiBEYXRlLCBpc091dE9mTW9udGg6IGJvb2xlYW4sIGlzVG9kYXk6IGJvb2xlYW4sIHNob3dTZWxlY3RlZDogYm9vbGVhbik6IERhdGVNb2RlbCB7XG4gICAgY29uc3Qgd2Vla0RheSA9IGRhdGUuZ2V0RGF5KCk7XG4gICAgY29uc3QgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7XG5cbiAgICBjb25zdCBkYXRlTW9kZWw6IERhdGVNb2RlbCA9IHtcbiAgICAgIElTT0RhdGU6IHRoaXMuZ2VuZXJhdGVJU09EYXRlKGRhdGUpLFxuICAgICAgZGF0ZTogZGF0ZSxcbiAgICAgIGRheUxhYmVsOiB0aGlzLmRheUxhYmVsc1t3ZWVrRGF5XSxcbiAgICAgIGlzT3V0T2ZNb250aDogaXNPdXRPZk1vbnRoLFxuICAgICAgaXNUb2RheTogaXNUb2RheSxcbiAgICAgIG1vbnRoTGFiZWw6IHRoaXMubW9udGhMYWJlbHNbbW9udGhdLFxuICAgICAgc2hvd1NlbGVjdGVkOiBzaG93U2VsZWN0ZWRcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRhdGVNb2RlbDtcbiAgfVxuXG4gIGNyZWF0ZURhdGVPYmplY3QoZGF5OiBudW1iZXIsIG1vbnRoOiBudW1iZXIsIHllYXI6IG51bWJlcik6IERhdGUge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gICAgZGF0ZS5zZXREYXRlKGRheSk7XG4gICAgZGF0ZS5zZXRNb250aChtb250aCk7XG4gICAgZGF0ZS5zZXRGdWxsWWVhcih5ZWFyKTtcblxuICAgIHJldHVybiBkYXRlO1xuICB9XG5cbiAgZmlsbFllYXJzKGN1cnJlbnRZZWFyOiBudW1iZXIpOiBBcnJheTxudW1iZXI+IHtcbiAgICBjb25zdCBmaXJzdFllYXIgPSBjdXJyZW50WWVhciAtIDEwMDtcbiAgICBjb25zdCBsYXN0WWVhciA9IGN1cnJlbnRZZWFyICsgMTAwO1xuICAgIGNvbnN0IHllYXJzID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gZmlyc3RZZWFyOyBpIDw9IGxhc3RZZWFyOyBpKyspIHtcbiAgICAgIHllYXJzLnB1c2goaSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHllYXJzO1xuICB9XG5cbiAgZmlsbFdlZWtzKG1vbnRoOiBudW1iZXIsIHllYXI6IG51bWJlcikge1xuICAgIHRoaXMuc2VsZWN0ZWRNb250aCA9IHtcbiAgICAgIGxhYmVsOiB0aGlzLm1vbnRoTGFiZWxzW21vbnRoXSxcbiAgICAgIG51bWJlcjogbW9udGgsXG4gICAgICB5ZWFyOiB5ZWFyXG4gICAgfTtcblxuICAgIGNvbnN0IGZpbmFsTW9udGhEYXkgPSB0aGlzLmNyZWF0ZURhdGVPYmplY3QoMCwgbW9udGgsIHllYXIpO1xuICAgIGNvbnN0IHdlZWtzID0gW107XG5cbiAgICBsZXQgaW5pdE1vbnRoRGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLCAxKTtcbiAgICBsZXQgZGF5ID0gMCAtIGluaXRNb250aERhdGUuZ2V0RGF5KCk7XG4gICAgbGV0IGRheXNJbldlZWsgPSBbXTtcblxuICAgIHdoaWxlIChpbml0TW9udGhEYXRlLmdldERheSgpICE9PSAwIHx8IGZpbmFsTW9udGhEYXkgPj0gaW5pdE1vbnRoRGF0ZSkge1xuICAgICAgKytkYXk7XG5cbiAgICAgIGluaXRNb250aERhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5KTtcblxuICAgICAgZGF5c0luV2Vlay5wdXNoKHRoaXMuY3JlYXRlRGF5RGF0ZShpbml0TW9udGhEYXRlLCBkYXksIGZpbmFsTW9udGhEYXkpKTtcblxuICAgICAgaWYgKGRheXNJbldlZWsubGVuZ3RoID09PSA3KSB7XG4gICAgICAgIHdlZWtzLnB1c2goZGF5c0luV2Vlayk7XG4gICAgICAgIGRheXNJbldlZWsgPSBbXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gd2Vla3M7XG4gIH1cblxuICBpc1RvZGF5RGF0ZShkYXRlOiBEYXRlKSB7XG4gICAgY29uc3QgSVNPQ3VycmVudERhdGUgPSB0aGlzLmdlbmVyYXRlSVNPRGF0ZShuZXcgRGF0ZSgpKTtcbiAgICBjb25zdCBJU09EYXRlID0gdGhpcy5nZW5lcmF0ZUlTT0RhdGUoZGF0ZSk7XG4gICAgY29uc3QgaXNUb2RheSA9IChJU09EYXRlID09PSBJU09DdXJyZW50RGF0ZSk7XG5cbiAgICByZXR1cm4gaXNUb2RheTtcbiAgfVxuXG4gIGNyZWF0ZURheURhdGUoZGF0ZTogRGF0ZSwgZGF5TnVtYmVyOiBudW1iZXIsIGZpbmFsTW9udGhEYXk6IERhdGUpOiBEYXRlTW9kZWwge1xuICAgIGNvbnN0IGlzVG9kYXkgPSB0aGlzLmlzVG9kYXlEYXRlKGRhdGUpO1xuICAgIGNvbnN0IGlzT3V0T2ZNb250aCA9IChkYXlOdW1iZXIgPD0gMCB8fCBkYXRlID4gZmluYWxNb250aERheSk7XG5cbiAgICByZXR1cm4gdGhpcy5jcmVhdGVEYXRlTW9kZWwoZGF0ZSwgaXNPdXRPZk1vbnRoLCBpc1RvZGF5LCB0cnVlKTtcbiAgfVxuXG4gIHNob3dQcmV2TW9udGgoKSB7XG4gICAgY29uc3QgbW9udGggPSB0aGlzLnNlbGVjdGVkTW9udGgubnVtYmVyO1xuICAgIGNvbnN0IHllYXIgPSB0aGlzLnNlbGVjdGVkTW9udGgueWVhcjtcblxuICAgIGNvbnN0IHByZXZNb250aCA9IG1vbnRoID49IDFcbiAgICAgID8gbW9udGggLSAxXG4gICAgICA6IDExO1xuXG4gICAgY29uc3QgcHJldlllYXIgPSBtb250aCA8IDFcbiAgICAgID8geWVhciAtIDFcbiAgICAgIDogeWVhcjtcblxuICAgIHRoaXMud2Vla3MgPSB0aGlzLmZpbGxXZWVrcyhwcmV2TW9udGgsIHByZXZZZWFyKTtcbiAgfVxuXG4gIHNob3dOZXh0TW9udGgoKSB7XG4gICAgY29uc3QgbW9udGggPSB0aGlzLnNlbGVjdGVkTW9udGgubnVtYmVyO1xuICAgIGNvbnN0IHllYXIgPSB0aGlzLnNlbGVjdGVkTW9udGgueWVhcjtcblxuICAgIGNvbnN0IG5leHRNb250aCA9IG1vbnRoIDwgMTFcbiAgICAgID8gbW9udGggKyAxXG4gICAgICA6IDA7XG5cbiAgICBjb25zdCBuZXh0WWVhciA9IG1vbnRoID49IDExXG4gICAgICA/IHllYXIgKyAxXG4gICAgICA6IHllYXI7XG5cbiAgICB0aGlzLndlZWtzID0gdGhpcy5maWxsV2Vla3MobmV4dE1vbnRoLCBuZXh0WWVhcik7XG4gIH1cblxuICBnZW5lcmF0ZUlTT0RhdGUoZGF0ZTogRGF0ZSkge1xuICAgIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF0ZSgpO1xuICAgIGNvbnN0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgY29uc3QgZGF5U3RyaW5nID0gZGF5ID4gOVxuICAgICAgPyBkYXlcbiAgICAgIDogYDAkeyBkYXkgfWA7XG5cbiAgICBjb25zdCBtb250aFN0cmluZyA9IG1vbnRoID4gOVxuICAgICAgPyBtb250aFxuICAgICAgOiBgMCR7IG1vbnRoIH1gO1xuXG4gICAgcmV0dXJuIGAkeyB5ZWFyIH0tJHsgbW9udGhTdHJpbmcgfS0keyBkYXlTdHJpbmcgfWA7XG4gIH1cblxuICBvblNlbGVjdERheShkYXRlOiBEYXRlTW9kZWwpIHtcbiAgICBpZiAoZGF0ZS5pc091dE9mTW9udGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNlbGVjdGVkRGF0ZSA9IGRhdGU7XG4gICAgdGhpcy5vblNlbGVjdERheUVtaXR0ZXIuZW1pdCh0aGlzLnNlbGVjdGVkRGF0ZSk7XG4gIH1cblxuICBvblNlbGVjdFllYXIoeWVhcjogbnVtYmVyKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCBkYXkgPSB0aGlzLnNlbGVjdGVkRGF0ZS5kYXRlLmdldERhdGUoKTtcbiAgICAgIGNvbnN0IG1vbnRoID0gdGhpcy5zZWxlY3RlZERhdGUuZGF0ZS5nZXRNb250aCgpO1xuXG4gICAgICB0aGlzLmRhdGUgPSB0aGlzLmNyZWF0ZURhdGVPYmplY3QoZGF5LCBtb250aCwgeWVhcik7XG4gICAgICB0aGlzLnNob3dZZWFycyA9IGZhbHNlO1xuICAgICAgdGhpcy5zZWxlY3RlZERhdGUgPSB0aGlzLmNyZWF0ZURhdGVNb2RlbCh0aGlzLmRhdGUsIGZhbHNlLCB0cnVlLCB0cnVlKTtcblxuICAgICAgdGhpcy53ZWVrcyA9IHRoaXMuZmlsbFdlZWtzKG1vbnRoLCB5ZWFyKTtcbiAgICB9LCB0aGlzLnNlbGVjdFllYXJBbmltYXRpb25EdXJhdGlvbik7XG4gIH1cblxuICBkaXNwbGF5WWVhcnMoKSB7XG4gICAgdGhpcy5zaG93WWVhcnMgPSB0cnVlO1xuXG4gICAgc2V0VGltZW91dCh0aGlzLnNjcm9sbFRvQWN0aXZlWWVhciwgMCk7XG4gIH1cblxuICBzY3JvbGxUb0FjdGl2ZVllYXIoKSB7XG4gICAgY29uc3QgeyBuYXRpdmVFbGVtZW50IH0gPSB0aGlzLnllYXJzQ29udGFpbmVyUmVmO1xuICAgIGNvbnN0IGFjdGl2ZVllYXI6IEhUTUxFbGVtZW50ID0gbmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0ZWQnKTtcblxuICAgIGlmIChhY3RpdmVZZWFyKSB7XG4gICAgICBjb25zdCB0b3AgPSB0aGlzLmdldFNjcm9sbENlbnRlcihuYXRpdmVFbGVtZW50LCBhY3RpdmVZZWFyKTtcblxuICAgICAgbmF0aXZlRWxlbWVudC5zY3JvbGxUb3AgPSB0b3A7XG4gICAgfVxuICB9XG5cbiAgZ2V0U2Nyb2xsQ2VudGVyKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGludGVybmFsRWxlbWVudDogSFRNTEVsZW1lbnQpOiBudW1iZXIge1xuICAgIGNvbnN0IHllYXJUb3AgPSBpbnRlcm5hbEVsZW1lbnQub2Zmc2V0VG9wO1xuICAgIGNvbnN0IHllYXJNaWRkbGVIZWlnaHQgPSBpbnRlcm5hbEVsZW1lbnQub2Zmc2V0SGVpZ2h0IC8gMjtcblxuICAgIGNvbnN0IGNvbnRhaW5lclRvcCA9IGNvbnRhaW5lci5vZmZzZXRUb3A7XG4gICAgY29uc3QgY29udGFpbmVyTWlkZGxlSGVpZ2h0ID0gY29udGFpbmVyLm9mZnNldEhlaWdodCAvIDI7XG5cbiAgICBjb25zdCBlbGVtZW50UmVsYXRpdmVUb3AgPSAoeWVhclRvcCAtIGNvbnRhaW5lclRvcCkgLSAoY29udGFpbmVyTWlkZGxlSGVpZ2h0IC0geWVhck1pZGRsZUhlaWdodCk7XG5cbiAgICBpZiAoZWxlbWVudFJlbGF0aXZlVG9wIDwgMCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnRSZWxhdGl2ZVRvcDtcbiAgfVxufVxuIl19