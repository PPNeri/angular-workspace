/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @license
 * Copyright Workylab. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://raw.githubusercontent.com/workylab/materialize-angular/master/LICENSE
 */
import { Component, ContentChildren, EventEmitter, forwardRef, Input, Output, QueryList } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { ButtonToggleComponent } from './button-toggle/button-toggle.component';
import { config } from '../../config';
var ButtonToggleGroupComponent = /** @class */ (function () {
    function ButtonToggleGroupComponent() {
        this.canUncheck = ButtonToggleGroupComponent.defaultProps.canUncheck;
        this.className = ButtonToggleGroupComponent.defaultProps.className;
        this.disabled = ButtonToggleGroupComponent.defaultProps.disabled;
        this.value = ButtonToggleGroupComponent.defaultProps.value;
        this.prefix = config.components.prefix;
        this.isFocused = false;
        this.onChangeEmitter = new EventEmitter();
        this.initButtons = this.initButtons.bind(this);
        this.registerButtons = this.registerButtons.bind(this);
        this.toggleButton = this.toggleButton.bind(this);
    }
    /**
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        this.initButtons();
        this.buttonsQueryList.changes.subscribe(this.initButtons);
    };
    /**
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.initButtons = /**
     * @return {?}
     */
    function () {
        if (this.disabled) {
            this.disableButtons(this.disabled);
        }
        setTimeout(this.registerButtons, 0);
    };
    /**
     * @param {?} disabled
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.disableButtons = /**
     * @param {?} disabled
     * @return {?}
     */
    function (disabled) {
        this.buttonsQueryList.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            item.disabled = disabled;
        }));
    };
    /**
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.registerButtons = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.buttonsQueryList.forEach((/**
         * @param {?} button
         * @return {?}
         */
        function (button) {
            button.isActive = (_this.value.lastIndexOf(button.value) >= 0);
            button.onClickEmitter.subscribe(_this.toggleButton);
        }));
    };
    /**
     * @param {?} value
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.toggleButton = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.setValueAllButtons(value);
        /** @type {?} */
        var currentButton = this.buttonsQueryList.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.value === value; }));
        this.value = currentButton && currentButton.isActive
            ? currentButton.value
            : '';
        this.onTouched();
        this.onChange(this.value);
        this.onChangeEmitter.emit(this.value);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.setValueAllButtons = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        this.buttonsQueryList.forEach((/**
         * @param {?} button
         * @return {?}
         */
        function (button) {
            if (button.value !== value) {
                button.isActive = false;
            }
            if (button.value === value && !_this.canUncheck) {
                button.isActive = true;
            }
        }));
    };
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.setDisabledState = /**
     * @param {?} isDisabled
     * @return {?}
     */
    function (isDisabled) {
        this.disabled = isDisabled;
        this.disableButtons(this.disabled);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.value = value;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.onChange = /**
     * @param {?} value
     * @return {?}
     */
    function (value) { };
    /**
     * @return {?}
     */
    ButtonToggleGroupComponent.prototype.onTouched = /**
     * @return {?}
     */
    function () { };
    ButtonToggleGroupComponent.defaultProps = {
        canUncheck: false,
        className: '',
        disabled: false,
        value: ''
    };
    ButtonToggleGroupComponent.decorators = [
        { type: Component, args: [{
                    providers: [{
                            multi: true,
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return ButtonToggleGroupComponent; }))
                        }],
                    selector: config.components.prefix + "-button-toggle-group }",
                    template: "<div \n  [ngClass]=\"[prefix + '-button-toggle-group', className]\"\n  [class.disabled]=\"disabled\"\n>\n  <ng-content select=\"materialize-button-toggle\"></ng-content>\n</div>\n  "
                }] }
    ];
    /** @nocollapse */
    ButtonToggleGroupComponent.ctorParameters = function () { return []; };
    ButtonToggleGroupComponent.propDecorators = {
        buttonsQueryList: [{ type: ContentChildren, args: [ButtonToggleComponent,] }],
        onChangeEmitter: [{ type: Output, args: ['onChange',] }],
        canUncheck: [{ type: Input }],
        className: [{ type: Input }],
        disabled: [{ type: Input }],
        value: [{ type: Input }]
    };
    return ButtonToggleGroupComponent;
}());
export { ButtonToggleGroupComponent };
if (false) {
    /** @type {?} */
    ButtonToggleGroupComponent.defaultProps;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.buttonsQueryList;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.onChangeEmitter;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.canUncheck;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.className;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.disabled;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.value;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.prefix;
    /** @type {?} */
    ButtonToggleGroupComponent.prototype.isFocused;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLXRvZ2dsZS1ncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9tYXRlcmlhbGl6ZS1hbmd1bGFyLyIsInNvdXJjZXMiOlsiYXBwL2NvbXBsZXRlZC1jb21wb25lbnRzL2J1dHRvbi10b2dnbGUtZ3JvdXAvYnV0dG9uLXRvZ2dsZS1ncm91cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBRUwsU0FBUyxFQUNULGVBQWUsRUFDZixZQUFZLEVBQ1osVUFBVSxFQUNWLEtBQUssRUFDTCxNQUFNLEVBQ04sU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUVoRixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRXRDO0lBOEJFO1FBVFMsZUFBVSxHQUFZLDBCQUEwQixDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUM7UUFDekUsY0FBUyxHQUFXLDBCQUEwQixDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUM7UUFDdEUsYUFBUSxHQUFZLDBCQUEwQixDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDckUsVUFBSyxHQUFXLDBCQUEwQixDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUM7UUFFaEUsV0FBTSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBS3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUxQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FB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aWNlbnNlXG4gKiBDb3B5cmlnaHQgV29ya3lsYWIuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3dvcmt5bGFiL21hdGVyaWFsaXplLWFuZ3VsYXIvbWFzdGVyL0xJQ0VOU0VcbiAqL1xuXG5pbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRXZlbnRFbWl0dGVyLFxuICBmb3J3YXJkUmVmLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3Rcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBCdXR0b25Ub2dnbGVDb21wb25lbnQgfSBmcm9tICcuL2J1dHRvbi10b2dnbGUvYnV0dG9uLXRvZ2dsZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgQnV0dG9uVG9nZ2xlR3JvdXBNb2RlbCB9IGZyb20gJy4vYnV0dG9uLXRvZ2dsZS1ncm91cC5tb2RlbCc7XG5pbXBvcnQgeyBjb25maWcgfSBmcm9tICcuLi8uLi9jb25maWcnO1xuXG5AQ29tcG9uZW50KHtcbiAgcHJvdmlkZXJzOiBbe1xuICAgIG11bHRpOiB0cnVlLFxuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEJ1dHRvblRvZ2dsZUdyb3VwQ29tcG9uZW50KVxuICB9XSxcbiAgc2VsZWN0b3I6IGAkeyBjb25maWcuY29tcG9uZW50cy5wcmVmaXggfS1idXR0b24tdG9nZ2xlLWdyb3VwIH1gLFxuICB0ZW1wbGF0ZVVybDogJy4vYnV0dG9uLXRvZ2dsZS1ncm91cC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQnV0dG9uVG9nZ2xlR3JvdXBDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgQWZ0ZXJDb250ZW50SW5pdCwgQnV0dG9uVG9nZ2xlR3JvdXBNb2RlbCB7XG4gIHN0YXRpYyByZWFkb25seSBkZWZhdWx0UHJvcHM6IEJ1dHRvblRvZ2dsZUdyb3VwTW9kZWwgPSB7XG4gICAgY2FuVW5jaGVjazogZmFsc2UsXG4gICAgY2xhc3NOYW1lOiAnJyxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgdmFsdWU6ICcnXG4gIH07XG5cbiAgQENvbnRlbnRDaGlsZHJlbihCdXR0b25Ub2dnbGVDb21wb25lbnQpIGJ1dHRvbnNRdWVyeUxpc3Q6IFF1ZXJ5TGlzdDxCdXR0b25Ub2dnbGVDb21wb25lbnQ+O1xuXG4gIEBPdXRwdXQoJ29uQ2hhbmdlJykgb25DaGFuZ2VFbWl0dGVyOiBFdmVudEVtaXR0ZXI8c3RyaW5nPjtcblxuICBASW5wdXQoKSBjYW5VbmNoZWNrOiBib29sZWFuID0gQnV0dG9uVG9nZ2xlR3JvdXBDb21wb25lbnQuZGVmYXVsdFByb3BzLmNhblVuY2hlY2s7XG4gIEBJbnB1dCgpIGNsYXNzTmFtZTogc3RyaW5nID0gQnV0dG9uVG9nZ2xlR3JvdXBDb21wb25lbnQuZGVmYXVsdFByb3BzLmNsYXNzTmFtZTtcbiAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW4gPSBCdXR0b25Ub2dnbGVHcm91cENvbXBvbmVudC5kZWZhdWx0UHJvcHMuZGlzYWJsZWQ7XG4gIEBJbnB1dCgpIHZhbHVlOiBzdHJpbmcgPSBCdXR0b25Ub2dnbGVHcm91cENvbXBvbmVudC5kZWZhdWx0UHJvcHMudmFsdWU7XG5cbiAgcHVibGljIHByZWZpeCA9IGNvbmZpZy5jb21wb25lbnRzLnByZWZpeDtcblxuICBwdWJsaWMgaXNGb2N1c2VkOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaXNGb2N1c2VkID0gZmFsc2U7XG4gICAgdGhpcy5vbkNoYW5nZUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICB0aGlzLmluaXRCdXR0b25zID0gdGhpcy5pbml0QnV0dG9ucy5iaW5kKHRoaXMpO1xuICAgIHRoaXMucmVnaXN0ZXJCdXR0b25zID0gdGhpcy5yZWdpc3RlckJ1dHRvbnMuYmluZCh0aGlzKTtcbiAgICB0aGlzLnRvZ2dsZUJ1dHRvbiA9IHRoaXMudG9nZ2xlQnV0dG9uLmJpbmQodGhpcyk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5pbml0QnV0dG9ucygpO1xuXG4gICAgdGhpcy5idXR0b25zUXVlcnlMaXN0LmNoYW5nZXMuc3Vic2NyaWJlKHRoaXMuaW5pdEJ1dHRvbnMpO1xuICB9XG5cbiAgaW5pdEJ1dHRvbnMoKSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuZGlzYWJsZUJ1dHRvbnModGhpcy5kaXNhYmxlZCk7XG4gICAgfVxuXG4gICAgc2V0VGltZW91dCh0aGlzLnJlZ2lzdGVyQnV0dG9ucywgMCk7XG4gIH1cblxuICBkaXNhYmxlQnV0dG9ucyhkaXNhYmxlZDogYm9vbGVhbikge1xuICAgIHRoaXMuYnV0dG9uc1F1ZXJ5TGlzdC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaXRlbS5kaXNhYmxlZCA9IGRpc2FibGVkO1xuICAgIH0pO1xuICB9XG5cbiAgcmVnaXN0ZXJCdXR0b25zKCkge1xuICAgIHRoaXMuYnV0dG9uc1F1ZXJ5TGlzdC5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICBidXR0b24uaXNBY3RpdmUgPSAodGhpcy52YWx1ZS5sYXN0SW5kZXhPZihidXR0b24udmFsdWUpID49IDApO1xuXG4gICAgICBidXR0b24ub25DbGlja0VtaXR0ZXIuc3Vic2NyaWJlKHRoaXMudG9nZ2xlQnV0dG9uKTtcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZUJ1dHRvbih2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5zZXRWYWx1ZUFsbEJ1dHRvbnModmFsdWUpO1xuXG4gICAgY29uc3QgY3VycmVudEJ1dHRvbiA9IHRoaXMuYnV0dG9uc1F1ZXJ5TGlzdC5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gdmFsdWUpO1xuXG4gICAgdGhpcy52YWx1ZSA9IGN1cnJlbnRCdXR0b24gJiYgY3VycmVudEJ1dHRvbi5pc0FjdGl2ZVxuICAgICAgPyBjdXJyZW50QnV0dG9uLnZhbHVlXG4gICAgICA6ICcnO1xuXG4gICAgdGhpcy5vblRvdWNoZWQoKTtcbiAgICB0aGlzLm9uQ2hhbmdlKHRoaXMudmFsdWUpO1xuXG4gICAgdGhpcy5vbkNoYW5nZUVtaXR0ZXIuZW1pdCh0aGlzLnZhbHVlKTtcbiAgfVxuXG4gIHNldFZhbHVlQWxsQnV0dG9ucyh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5idXR0b25zUXVlcnlMaXN0LmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgIGlmIChidXR0b24udmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIGJ1dHRvbi5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoYnV0dG9uLnZhbHVlID09PSB2YWx1ZSAmJiAhdGhpcy5jYW5VbmNoZWNrKSB7XG4gICAgICAgIGJ1dHRvbi5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcblxuICAgIHRoaXMuZGlzYWJsZUJ1dHRvbnModGhpcy5kaXNhYmxlZCk7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAodmFsdWU6IHN0cmluZykgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIG9uQ2hhbmdlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHt9XG5cbiAgb25Ub3VjaGVkKCk6IHZvaWQge31cbn1cbiJdfQ==