/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @license
 * Copyright Workylab. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://raw.githubusercontent.com/workylab/materialize-angular/master/LICENSE
 */
import { Component, Input } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { config } from '../../config';
export class HTMLVisualizerComponent {
    /**
     * @param {?} sanitizer
     */
    constructor(sanitizer) {
        this.sanitizer = sanitizer;
        this.className = HTMLVisualizerComponent.defaultProps.className;
        this.html = HTMLVisualizerComponent.defaultProps.html;
        this.prefix = config.components.prefix;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.htmlContent = this.render(this.html);
    }
    /**
     * @param {?} html
     * @return {?}
     */
    render(html) {
        /** @type {?} */
        const tags = this.splitByTags(html);
        /** @type {?} */
        const lines = [];
        /** @type {?} */
        let depth = 0;
        for (let i = 0; i < tags.length; i++) {
            /** @type {?} */
            const currentTag = tags[i];
            /** @type {?} */
            const nextTag = tags[i + 1];
            /** @type {?} */
            const lastTag = tags[i + 2];
            /** @type {?} */
            const result = this.createLineLogic(currentTag, nextTag, lastTag, depth, i);
            depth = result.depth;
            i = result.cycle;
            lines.push(result.line);
        }
        return lines.join('<br />');
    }
    /**
     * @param {?} content
     * @param {?} className
     * @return {?}
     */
    createNode(content, className) {
        /** @type {?} */
        let escapedContent = content.replace(/&/g, '&amp;');
        escapedContent = escapedContent.trim();
        escapedContent = escapedContent.replace(/\[\[/g, '&#123&#123;');
        escapedContent = escapedContent.replace(/\]\]/g, '&#125&#125;');
        escapedContent = escapedContent.replace(/</g, '&lt;');
        escapedContent = escapedContent.replace(/>/g, '&gt;');
        escapedContent = escapedContent.replace(/(\S+)="([^']*?)"/g, (/**
         * @param {?} match
         * @return {?}
         */
        match => {
            /** @type {?} */
            const value = match.match(/"([^']*?)"/g);
            /** @type {?} */
            const attribute = match.match(/(\S+)=/g);
            /** @type {?} */
            const attributeValidated = (attribute && attribute[0]) || '';
            /** @type {?} */
            const valueValidated = (value && value[0]) || '';
            /** @type {?} */
            const attributeTag = `<span class="${HTMLVisualizerComponent.ATTRIBUTE_CLASS}">${attributeValidated}</span>`;
            /** @type {?} */
            const valueTag = `<span class="${HTMLVisualizerComponent.VALUE_CLASS}">${valueValidated}</span>`;
            return attributeTag + valueTag;
        }));
        escapedContent = escapedContent.replace(/(&lt;\/|&lt;)/g, (/**
         * @param {?} match
         * @return {?}
         */
        match => `<span class="${HTMLVisualizerComponent.SYMBOL_CLASS}">&lt;${match.includes('/') ? '/' : ''}</span>`));
        escapedContent = escapedContent.replace(/(\/&gt;|&gt;)/g, (/**
         * @param {?} match
         * @return {?}
         */
        match => `<span class="${HTMLVisualizerComponent.SYMBOL_CLASS}">${match.includes('/') ? '/' : ''}&gt;</span>`));
        return `<span class="${className}">${escapedContent}</span>`;
    }
    /**
     * @param {?} depth
     * @param {?} content
     * @return {?}
     */
    indentNode(depth, content) {
        /** @type {?} */
        const indentationBase = '&emsp;&emsp;';
        /** @type {?} */
        const indentation = indentationBase.repeat(depth);
        return `${indentation}${content}`;
    }
    /**
     * @param {?} xml
     * @return {?}
     */
    splitByTags(xml) {
        /** @type {?} */
        const tags = xml.split(/(<\/?[^>]+>)/g);
        /** @type {?} */
        const cleanedTags = tags.filter((/**
         * @param {?} line
         * @return {?}
         */
        line => line.trim() !== ''));
        return cleanedTags;
    }
    /**
     * @param {?} contentNode
     * @return {?}
     */
    isTag(contentNode) {
        return (/<[^>!]+>/).test(contentNode);
    }
    /**
     * @param {?} contentNode
     * @return {?}
     */
    isOpeningTag(contentNode) {
        if (this.isTag(contentNode) && !this.isClosingTag(contentNode) && !this.isSelfClosingTag(contentNode)) {
            return true;
        }
        return false;
    }
    /**
     * @param {?} contentNode
     * @return {?}
     */
    isClosingTag(contentNode) {
        return (/<\/+[^>]+>/).test(contentNode);
    }
    /**
     * @param {?} contentNode
     * @return {?}
     */
    isSelfClosingTag(contentNode) {
        return (/<[^>]+\/>/).test(contentNode);
    }
    /**
     * @param {?} firstTag
     * @param {?} middleTag
     * @param {?} lastTag
     * @param {?} depth
     * @param {?} cycle
     * @return {?}
     */
    createLineLogic(firstTag, middleTag, lastTag, depth, cycle) {
        if (this.isOpeningTag(firstTag) && this.isClosingTag(middleTag)) {
            /** @type {?} */
            const openNode = this.createNode(firstTag, 'tag');
            /** @type {?} */
            const closeNode = this.createNode(middleTag, 'tag');
            return {
                cycle: cycle + 1,
                depth: depth,
                line: this.indentNode(depth, `${openNode}${closeNode}`)
            };
        }
        if (this.isOpeningTag(firstTag) && !this.isTag(middleTag)) {
            /** @type {?} */
            const openNode = this.createNode(firstTag, 'tag');
            /** @type {?} */
            const contentNode = this.createNode(middleTag, 'string');
            /** @type {?} */
            const closeNode = this.createNode(lastTag, 'tag');
            return {
                cycle: cycle + 2,
                depth: depth,
                line: this.indentNode(depth, `${openNode}${contentNode}${closeNode}`)
            };
        }
        if (this.isSelfClosingTag(firstTag)) {
            /** @type {?} */
            const selfClosingNode = this.createNode(firstTag, 'tag');
            return {
                cycle: cycle,
                depth: depth,
                line: this.indentNode(depth, selfClosingNode)
            };
        }
        if (this.isClosingTag(firstTag)) {
            /** @type {?} */
            const closeNode = this.createNode(firstTag, 'tag');
            return {
                cycle: cycle,
                depth: depth - 1,
                line: this.indentNode(depth - 1, closeNode)
            };
        }
        return {
            cycle: cycle,
            depth: depth + 1,
            line: this.indentNode(depth, this.createNode(firstTag, 'text'))
        };
    }
}
HTMLVisualizerComponent.ATTRIBUTE_CLASS = `${config.components.prefix}-html-visualizer-attribute`;
HTMLVisualizerComponent.VALUE_CLASS = `${config.components.prefix}-html-visualizer-value`;
HTMLVisualizerComponent.SYMBOL_CLASS = `${config.components.prefix}-html-visualizer-symbol`;
HTMLVisualizerComponent.defaultProps = {
    className: '',
    html: ''
};
HTMLVisualizerComponent.decorators = [
    { type: Component, args: [{
                selector: `${config.components.prefix}-html-visualizer`,
                template: "<div [ngClass]=\"prefix + '-html-visualizer'\">\n  <div [ngClass]=\"prefix + '-html-visualizer-content'\" [innerHTML]=\"htmlContent\" ngNonBindable></div>\n</div>\n"
            }] }
];
/** @nocollapse */
HTMLVisualizerComponent.ctorParameters = () => [
    { type: DomSanitizer }
];
HTMLVisualizerComponent.propDecorators = {
    className: [{ type: Input }],
    html: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    HTMLVisualizerComponent.ATTRIBUTE_CLASS;
    /** @type {?} */
    HTMLVisualizerComponent.VALUE_CLASS;
    /** @type {?} */
    HTMLVisualizerComponent.SYMBOL_CLASS;
    /** @type {?} */
    HTMLVisualizerComponent.defaultProps;
    /** @type {?} */
    HTMLVisualizerComponent.prototype.className;
    /** @type {?} */
    HTMLVisualizerComponent.prototype.html;
    /** @type {?} */
    HTMLVisualizerComponent.prototype.htmlContent;
    /** @type {?} */
    HTMLVisualizerComponent.prototype.prefix;
    /**
     * @type {?}
     * @private
     */
    HTMLVisualizerComponent.prototype.sanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHRtbC12aXN1YWxpemVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21hdGVyaWFsaXplLWFuZ3VsYXIvIiwic291cmNlcyI6WyJhcHAvY29tcGxldGVkLWNvbXBvbmVudHMvaHRtbC12aXN1YWxpemVyL2h0bWwtdmlzdWFsaXplci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFZLE1BQU0sMkJBQTJCLENBQUM7QUFDbkUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGNBQWMsQ0FBQztBQU90QyxNQUFNLE9BQU8sdUJBQXVCOzs7O0lBZ0JsQyxZQUFvQixTQUF1QjtRQUF2QixjQUFTLEdBQVQsU0FBUyxDQUFjO1FBTmxDLGNBQVMsR0FBVyx1QkFBdUIsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDO1FBQ25FLFNBQUksR0FBVyx1QkFBdUIsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDO1FBRzNELFdBQU0sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQztJQUd6QyxDQUFDOzs7O0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQzs7Ozs7SUFFRCxNQUFNLENBQUMsSUFBWTs7Y0FDWCxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUM7O2NBQzdCLEtBQUssR0FBRyxFQUFFOztZQUVaLEtBQUssR0FBRyxDQUFDO1FBRWIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7O2tCQUM5QixVQUFVLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQzs7a0JBQ3BC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biAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgV29ya3lsYWIuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3dvcmt5bGFiL21hdGVyaWFsaXplLWFuZ3VsYXIvbWFzdGVyL0xJQ0VOU0VcbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERvbVNhbml0aXplciwgU2FmZUh0bWwgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZyc7XG5pbXBvcnQgeyBIVE1MVmlzdWFsaXplck1vZGVsIH0gZnJvbSAnLi9odG1sLXZpc3VhbGl6ZXIubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IGAkeyBjb25maWcuY29tcG9uZW50cy5wcmVmaXggfS1odG1sLXZpc3VhbGl6ZXJgLFxuICB0ZW1wbGF0ZVVybDogJy4vaHRtbC12aXN1YWxpemVyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBIVE1MVmlzdWFsaXplckNvbXBvbmVudCBpbXBsZW1lbnRzIEhUTUxWaXN1YWxpemVyTW9kZWwsIE9uSW5pdCB7XG4gIHN0YXRpYyByZWFkb25seSBBVFRSSUJVVEVfQ0xBU1MgPSBgJHsgY29uZmlnLmNvbXBvbmVudHMucHJlZml4IH0taHRtbC12aXN1YWxpemVyLWF0dHJpYnV0ZWA7XG4gIHN0YXRpYyByZWFkb25seSBWQUxVRV9DTEFTUyA9IGAkeyBjb25maWcuY29tcG9uZW50cy5wcmVmaXggfS1odG1sLXZpc3VhbGl6ZXItdmFsdWVgO1xuICBzdGF0aWMgcmVhZG9ubHkgU1lNQk9MX0NMQVNTID0gYCR7IGNvbmZpZy5jb21wb25lbnRzLnByZWZpeCB9LWh0bWwtdmlzdWFsaXplci1zeW1ib2xgO1xuXG4gIHN0YXRpYyByZWFkb25seSBkZWZhdWx0UHJvcHM6IEhUTUxWaXN1YWxpemVyTW9kZWwgPSB7XG4gICAgY2xhc3NOYW1lOiAnJyxcbiAgICBodG1sOiAnJ1xuICB9O1xuXG4gIEBJbnB1dCgpIGNsYXNzTmFtZTogc3RyaW5nID0gSFRNTFZpc3VhbGl6ZXJDb21wb25lbnQuZGVmYXVsdFByb3BzLmNsYXNzTmFtZTtcbiAgQElucHV0KCkgaHRtbDogc3RyaW5nID0gSFRNTFZpc3VhbGl6ZXJDb21wb25lbnQuZGVmYXVsdFByb3BzLmh0bWw7XG5cbiAgcHVibGljIGh0bWxDb250ZW50OiBTYWZlSHRtbDtcbiAgcHVibGljIHByZWZpeCA9IGNvbmZpZy5jb21wb25lbnRzLnByZWZpeDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyKSB7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmh0bWxDb250ZW50ID0gdGhpcy5yZW5kZXIodGhpcy5odG1sKTtcbiAgfVxuXG4gIHJlbmRlcihodG1sOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHRhZ3MgPSB0aGlzLnNwbGl0QnlUYWdzKGh0bWwpO1xuICAgIGNvbnN0IGxpbmVzID0gW107XG5cbiAgICBsZXQgZGVwdGggPSAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjdXJyZW50VGFnID0gdGFnc1tpXTtcbiAgICAgIGNvbnN0IG5leHRUYWcgPSB0YWdzW2kgKyAxXTtcbiAgICAgIGNvbnN0IGxhc3RUYWcgPSB0YWdzW2kgKyAyXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5jcmVhdGVMaW5lTG9naWMoY3VycmVudFRhZywgbmV4dFRhZywgbGFzdFRhZywgZGVwdGgsIGkpO1xuXG4gICAgICBkZXB0aCA9IHJlc3VsdC5kZXB0aDtcbiAgICAgIGkgPSByZXN1bHQuY3ljbGU7XG4gICAgICBsaW5lcy5wdXNoKHJlc3VsdC5saW5lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbGluZXMuam9pbignPGJyIC8+Jyk7XG4gIH1cblxuICBjcmVhdGVOb2RlKGNvbnRlbnQ6IHN0cmluZywgY2xhc3NOYW1lOiBzdHJpbmcpIHtcbiAgICBsZXQgZXNjYXBlZENvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoLyYvZywgJyZhbXA7Jyk7XG5cbiAgICBlc2NhcGVkQ29udGVudCA9IGVzY2FwZWRDb250ZW50LnRyaW0oKTtcbiAgICBlc2NhcGVkQ29udGVudCA9IGVzY2FwZWRDb250ZW50LnJlcGxhY2UoL1xcW1xcWy9nLCAnJiMxMjMmIzEyMzsnKTtcbiAgICBlc2NhcGVkQ29udGVudCA9IGVzY2FwZWRDb250ZW50LnJlcGxhY2UoL1xcXVxcXS9nLCAnJiMxMjUmIzEyNTsnKTtcblxuICAgIGVzY2FwZWRDb250ZW50ID0gZXNjYXBlZENvbnRlbnQucmVwbGFjZSgvPC9nLCAnJmx0OycpO1xuICAgIGVzY2FwZWRDb250ZW50ID0gZXNjYXBlZENvbnRlbnQucmVwbGFjZSgvPi9nLCAnJmd0OycpO1xuXG4gICAgZXNjYXBlZENvbnRlbnQgPSBlc2NhcGVkQ29udGVudC5yZXBsYWNlKC8oXFxTKyk9XCIoW14nXSo/KVwiL2csIG1hdGNoID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbWF0Y2gubWF0Y2goL1wiKFteJ10qPylcIi9nKTtcbiAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IG1hdGNoLm1hdGNoKC8oXFxTKyk9L2cpO1xuICAgICAgY29uc3QgYXR0cmlidXRlVmFsaWRhdGVkID0gKGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGVbMF0pIHx8ICcnO1xuICAgICAgY29uc3QgdmFsdWVWYWxpZGF0ZWQgPSAodmFsdWUgJiYgdmFsdWVbMF0pIHx8ICcnO1xuXG4gICAgICBjb25zdCBhdHRyaWJ1dGVUYWcgPSBgPHNwYW4gY2xhc3M9XCIkeyBIVE1MVmlzdWFsaXplckNvbXBvbmVudC5BVFRSSUJVVEVfQ0xBU1MgfVwiPiR7IGF0dHJpYnV0ZVZhbGlkYXRlZCB9PC9zcGFuPmA7XG4gICAgICBjb25zdCB2YWx1ZVRhZyA9IGA8c3BhbiBjbGFzcz1cIiR7IEhUTUxWaXN1YWxpemVyQ29tcG9uZW50LlZBTFVFX0NMQVNTIH1cIj4keyB2YWx1ZVZhbGlkYXRlZCB9PC9zcGFuPmA7XG5cbiAgICAgIHJldHVybiBhdHRyaWJ1dGVUYWcgKyB2YWx1ZVRhZztcbiAgICB9KTtcblxuICAgIGVzY2FwZWRDb250ZW50ID0gZXNjYXBlZENvbnRlbnQucmVwbGFjZSgvKCZsdDtcXC98Jmx0OykvZywgbWF0Y2ggPT5cbiAgICAgIGA8c3BhbiBjbGFzcz1cIiR7IEhUTUxWaXN1YWxpemVyQ29tcG9uZW50LlNZTUJPTF9DTEFTUyB9XCI+Jmx0OyR7IG1hdGNoLmluY2x1ZGVzKCcvJykgPyAnLycgOiAnJyB9PC9zcGFuPmBcbiAgICApO1xuXG4gICAgZXNjYXBlZENvbnRlbnQgPSBlc2NhcGVkQ29udGVudC5yZXBsYWNlKC8oXFwvJmd0O3wmZ3Q7KS9nLCBtYXRjaCA9PlxuICAgICAgYDxzcGFuIGNsYXNzPVwiJHsgSFRNTFZpc3VhbGl6ZXJDb21wb25lbnQuU1lNQk9MX0NMQVNTIH1cIj4keyBtYXRjaC5pbmNsdWRlcygnLycpID8gJy8nIDogJycgfSZndDs8L3NwYW4+YFxuICAgICk7XG5cbiAgICByZXR1cm4gYDxzcGFuIGNsYXNzPVwiJHsgY2xhc3NOYW1lIH1cIj4keyBlc2NhcGVkQ29udGVudCB9PC9zcGFuPmA7XG4gIH1cblxuICBpbmRlbnROb2RlKGRlcHRoOiBudW1iZXIsIGNvbnRlbnQ6IHN0cmluZykge1xuICAgIGNvbnN0IGluZGVudGF0aW9uQmFzZSA9ICcmZW1zcDsmZW1zcDsnO1xuICAgIGNvbnN0IGluZGVudGF0aW9uID0gaW5kZW50YXRpb25CYXNlLnJlcGVhdChkZXB0aCk7XG5cbiAgICByZXR1cm4gYCR7IGluZGVudGF0aW9uIH0keyBjb250ZW50IH1gO1xuICB9XG5cbiAgc3BsaXRCeVRhZ3MoeG1sOiBzdHJpbmcpOiBBcnJheTxzdHJpbmc+IHtcbiAgICBjb25zdCB0YWdzID0geG1sLnNwbGl0KC8oPFxcLz9bXj5dKz4pL2cpO1xuICAgIGNvbnN0IGNsZWFuZWRUYWdzID0gdGFncy5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSAhPT0gJycpO1xuXG4gICAgcmV0dXJuIGNsZWFuZWRUYWdzO1xuICB9XG5cbiAgaXNUYWcoY29udGVudE5vZGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoLzxbXj4hXSs+LykudGVzdChjb250ZW50Tm9kZSk7XG4gIH1cblxuICBpc09wZW5pbmdUYWcoY29udGVudE5vZGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmlzVGFnKGNvbnRlbnROb2RlKSAmJiAhdGhpcy5pc0Nsb3NpbmdUYWcoY29udGVudE5vZGUpICYmICF0aGlzLmlzU2VsZkNsb3NpbmdUYWcoY29udGVudE5vZGUpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpc0Nsb3NpbmdUYWcoY29udGVudE5vZGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoLzxcXC8rW14+XSs+LykudGVzdChjb250ZW50Tm9kZSk7XG4gIH1cblxuICBpc1NlbGZDbG9zaW5nVGFnKGNvbnRlbnROb2RlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKC88W14+XStcXC8+LykudGVzdChjb250ZW50Tm9kZSk7XG4gIH1cblxuICBjcmVhdGVMaW5lTG9naWMoZmlyc3RUYWc6IHN0cmluZywgbWlkZGxlVGFnOiBzdHJpbmcsIGxhc3RUYWc6IHN0cmluZywgZGVwdGg6IG51bWJlciwgY3ljbGU6IG51bWJlcik6IGFueSB7XG4gICAgaWYgKHRoaXMuaXNPcGVuaW5nVGFnKGZpcnN0VGFnKSAmJiB0aGlzLmlzQ2xvc2luZ1RhZyhtaWRkbGVUYWcpKSB7XG4gICAgICBjb25zdCBvcGVuTm9kZSA9IHRoaXMuY3JlYXRlTm9kZShmaXJzdFRhZywgJ3RhZycpO1xuICAgICAgY29uc3QgY2xvc2VOb2RlID0gdGhpcy5jcmVhdGVOb2RlKG1pZGRsZVRhZywgJ3RhZycpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjeWNsZTogY3ljbGUgKyAxLFxuICAgICAgICBkZXB0aDogZGVwdGgsXG4gICAgICAgIGxpbmU6IHRoaXMuaW5kZW50Tm9kZShkZXB0aCwgYCR7IG9wZW5Ob2RlIH0keyBjbG9zZU5vZGUgfWApXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzT3BlbmluZ1RhZyhmaXJzdFRhZykgJiYgIXRoaXMuaXNUYWcobWlkZGxlVGFnKSkge1xuICAgICAgY29uc3Qgb3Blbk5vZGUgPSB0aGlzLmNyZWF0ZU5vZGUoZmlyc3RUYWcsICd0YWcnKTtcbiAgICAgIGNvbnN0IGNvbnRlbnROb2RlID0gdGhpcy5jcmVhdGVOb2RlKG1pZGRsZVRhZywgJ3N0cmluZycpO1xuICAgICAgY29uc3QgY2xvc2VOb2RlID0gdGhpcy5jcmVhdGVOb2RlKGxhc3RUYWcsICd0YWcnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY3ljbGU6IGN5Y2xlICsgMixcbiAgICAgICAgZGVwdGg6IGRlcHRoLFxuICAgICAgICBsaW5lOiB0aGlzLmluZGVudE5vZGUoZGVwdGgsIGAkeyBvcGVuTm9kZSB9JHsgY29udGVudE5vZGUgfSR7IGNsb3NlTm9kZSB9YClcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNTZWxmQ2xvc2luZ1RhZyhmaXJzdFRhZykpIHtcbiAgICAgIGNvbnN0IHNlbGZDbG9zaW5nTm9kZSA9IHRoaXMuY3JlYXRlTm9kZShmaXJzdFRhZywgJ3RhZycpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjeWNsZTogY3ljbGUsXG4gICAgICAgIGRlcHRoOiBkZXB0aCxcbiAgICAgICAgbGluZTogdGhpcy5pbmRlbnROb2RlKGRlcHRoLCBzZWxmQ2xvc2luZ05vZGUpXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzQ2xvc2luZ1RhZyhmaXJzdFRhZykpIHtcbiAgICAgIGNvbnN0IGNsb3NlTm9kZSA9IHRoaXMuY3JlYXRlTm9kZShmaXJzdFRhZywgJ3RhZycpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjeWNsZTogY3ljbGUsXG4gICAgICAgIGRlcHRoOiBkZXB0aCAtIDEsXG4gICAgICAgIGxpbmU6IHRoaXMuaW5kZW50Tm9kZShkZXB0aCAtIDEsIGNsb3NlTm9kZSlcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGN5Y2xlOiBjeWNsZSxcbiAgICAgIGRlcHRoOiBkZXB0aCArIDEsXG4gICAgICBsaW5lOiB0aGlzLmluZGVudE5vZGUoZGVwdGgsIHRoaXMuY3JlYXRlTm9kZShmaXJzdFRhZywgJ3RleHQnKSlcbiAgICB9O1xuICB9XG59XG4iXX0=