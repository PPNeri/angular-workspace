/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @license
 * Copyright Workylab. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://raw.githubusercontent.com/workylab/materialize-angular/master/LICENSE
 */
import { Component, ElementRef, forwardRef, Input, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { config } from '../../config';
import { INPUT_TYPE } from '../input/input.model';
export class DatePickerComponent {
    constructor() {
        this.className = DatePickerComponent.defaultProps.className;
        this.disabled = DatePickerComponent.defaultProps.disabled;
        this.displayOtherMonthDays = DatePickerComponent.defaultProps.displayOtherMonthDays;
        this.floatLabel = DatePickerComponent.defaultProps.floatLabel;
        this.format = DatePickerComponent.defaultProps.format;
        this.fullSize = DatePickerComponent.defaultProps.fullSize;
        this.id = DatePickerComponent.defaultProps.id;
        this.name = DatePickerComponent.defaultProps.name;
        this.placeholder = DatePickerComponent.defaultProps.placeholder;
        this.required = DatePickerComponent.defaultProps.required;
        this.inputValue = DatePickerComponent.defaultProps.value;
        this.prefix = config.components.prefix;
        this.isOpen = false;
        this.close = this.close.bind(this);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // this.date = this.buildDate(this.inputValue);
    }
    /**
     * @param {?} selectedDate
     * @return {?}
     */
    onSelectDay(selectedDate) {
        this.isOpen = false;
        this.date = selectedDate.date;
        this.inputValue = this.formatDate(selectedDate.date);
        this.onChange(selectedDate.date);
    }
    /**
     * @param {?} date
     * @return {?}
     */
    formatDate(date) {
        /** @type {?} */
        const day = date.getDate();
        /** @type {?} */
        const month = date.getMonth() + 1;
        /** @type {?} */
        const dayString = day < 10
            ? `0${day}`
            : day.toString();
        /** @type {?} */
        const monthString = month < 10
            ? `0${month}`
            : month.toString();
        /** @type {?} */
        const yearString = date.getFullYear().toString();
        /** @type {?} */
        const formatedDate = this.format
            .replace('dd', dayString)
            .replace('mm', monthString)
            .replace('yyyy', yearString);
        return formatedDate;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    buildDate(value) {
        /** @type {?} */
        const dayStartPosition = this.format.indexOf(DatePickerComponent.DAY_KEY);
        /** @type {?} */
        const monthStartPosition = this.format.indexOf(DatePickerComponent.MONTH_KEY);
        /** @type {?} */
        const yearStartPosition = this.format.indexOf(DatePickerComponent.YEAR_KEY);
        if (dayStartPosition >= 0 && monthStartPosition >= 0 && yearStartPosition >= 0) {
            /** @type {?} */
            const dayEndPosition = dayStartPosition + DatePickerComponent.DAY_KEY.length;
            /** @type {?} */
            const monthEndPosition = monthStartPosition + DatePickerComponent.MONTH_KEY.length;
            /** @type {?} */
            const yearEndPosition = yearStartPosition + DatePickerComponent.YEAR_KEY.length;
            /** @type {?} */
            const dayString = value.substring(dayStartPosition, dayEndPosition);
            /** @type {?} */
            const monthString = value.substring(monthStartPosition, monthEndPosition);
            /** @type {?} */
            const yearString = value.substring(yearStartPosition, yearEndPosition);
            if (dayString && monthString && yearString) {
                /** @type {?} */
                const day = Number(dayString);
                /** @type {?} */
                const month = Number(monthString) - 1;
                /** @type {?} */
                const year = Number(yearString);
                return new Date(year, month, day);
            }
        }
        return new Date();
    }
    /**
     * @return {?}
     */
    open() {
        this.isOpen = true;
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.backdropRef.nativeElement.addEventListener('click', this.close);
        }), 0);
    }
    /**
     * @return {?}
     */
    close() {
        this.isOpen = false;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    onInputChange(value) {
        this.date = this.buildDate(value);
        this.onChange(this.date);
    }
    /**
     * @return {?}
     */
    onInputFocus() {
        this.onTouched();
    }
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        this.date = value;
        this.inputValue = this.formatDate(value);
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    onChange(value) {
    }
    /**
     * @return {?}
     */
    onTouched() { }
}
DatePickerComponent.DAY_KEY = 'dd';
DatePickerComponent.MONTH_KEY = 'mm';
DatePickerComponent.YEAR_KEY = 'yyyy';
DatePickerComponent.defaultProps = {
    autocomplete: 'none',
    className: '',
    date: new Date(),
    disabled: false,
    displayOtherMonthDays: true,
    floatLabel: '',
    format: 'dd-mm-yyyy',
    fullSize: false,
    hasCounter: false,
    id: null,
    maxLength: 500,
    name: '',
    placeholder: '',
    required: false,
    type: INPUT_TYPE.TEXT,
    value: ''
};
DatePickerComponent.decorators = [
    { type: Component, args: [{
                providers: [{
                        multi: true,
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => DatePickerComponent))
                    }],
                selector: `${config.components.prefix}-datepicker }`,
                template: "<div [ngClass]=\"[prefix + '-datepicker', className]\" [class.full-size]=\"fullSize\">\n  <div #backdrop *ngIf=\"isOpen\" [ngClass]=\"prefix + '-datepicker-backdrop'\"></div>\n\n  <materialize-input\n    [disabled]=\"disabled\"\n    [floatLabel]=\"floatLabel\"\n    [id]=\"id\"\n    [placeholder]=\"placeholder\"\n    [required]=\"required\"\n    [value]=\"inputValue\"\n\n    (onChange)=\"onInputChange($event)\"\n    (onFocus)=\"onInputFocus()\"\n  >\n    <materialize-button (onClick)=\"open()\"\n      materializeSuffix\n      [className]=\"prefix + '-datepicker-button'\"\n      [disabled]=\"disabled\"\n    >\n      <materialize-icon [className]=\"prefix + '-datepicker-button'\">calendar_today</materialize-icon>\n    </materialize-button>\n  </materialize-input>\n\n  <materialize-calendar *ngIf=\"isOpen\"\n    [className]=\"prefix + '-datepicker-calendar'\"\n    [date]=\"date\"\n    (onSelectDay)=\"onSelectDay($event)\">\n  </materialize-calendar>\n</div>\n"
            }] }
];
/** @nocollapse */
DatePickerComponent.ctorParameters = () => [];
DatePickerComponent.propDecorators = {
    backdropRef: [{ type: ViewChild, args: ['backdrop', { static: false },] }],
    className: [{ type: Input }],
    disabled: [{ type: Input }],
    displayOtherMonthDays: [{ type: Input }],
    floatLabel: [{ type: Input }],
    format: [{ type: Input }],
    fullSize: [{ type: Input }],
    id: [{ type: Input }],
    name: [{ type: Input }],
    placeholder: [{ type: Input }],
    required: [{ type: Input }],
    inputValue: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DatePickerComponent.DAY_KEY;
    /** @type {?} */
    DatePickerComponent.MONTH_KEY;
    /** @type {?} */
    DatePickerComponent.YEAR_KEY;
    /** @type {?} */
    DatePickerComponent.defaultProps;
    /** @type {?} */
    DatePickerComponent.prototype.backdropRef;
    /** @type {?} */
    DatePickerComponent.prototype.className;
    /** @type {?} */
    DatePickerComponent.prototype.disabled;
    /** @type {?} */
    DatePickerComponent.prototype.displayOtherMonthDays;
    /** @type {?} */
    DatePickerComponent.prototype.floatLabel;
    /** @type {?} */
    DatePickerComponent.prototype.format;
    /** @type {?} */
    DatePickerComponent.prototype.fullSize;
    /** @type {?} */
    DatePickerComponent.prototype.id;
    /** @type {?} */
    DatePickerComponent.prototype.name;
    /** @type {?} */
    DatePickerComponent.prototype.placeholder;
    /** @type {?} */
    DatePickerComponent.prototype.required;
    /** @type {?} */
    DatePickerComponent.prototype.inputValue;
    /** @type {?} */
    DatePickerComponent.prototype.prefix;
    /** @type {?} */
    DatePickerComponent.prototype.date;
    /** @type {?} */
    DatePickerComponent.prototype.isOpen;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9tYXRlcmlhbGl6ZS1hbmd1bGFyLyIsInNvdXJjZXMiOlsiYXBwL2NvbXBsZXRlZC1jb21wb25lbnRzL2RhdGVwaWNrZXIvZGF0ZXBpY2tlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFVLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUd0QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFXbEQsTUFBTSxPQUFPLG1CQUFtQjtJQTJDOUI7UUFqQlMsY0FBUyxHQUFXLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUM7UUFDL0QsYUFBUSxHQUFZLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDOUQsMEJBQXFCLEdBQVksbUJBQW1CLENBQUMsWUFBWSxDQUFDLHFCQUFxQixDQUFDO1FBQ3hGLGVBQVUsR0FBVyxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDO1FBQ2pFLFdBQU0sR0FBVyxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO1FBQ3pELGFBQVEsR0FBWSxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO1FBQzlELE9BQUUsR0FBa0IsbUJBQW1CLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztRQUN4RCxTQUFJLEdBQVcsbUJBQW1CLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQztRQUNyRCxnQkFBVyxHQUFXLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7UUFDbkUsYUFBUSxHQUFZLG1CQUFtQixDQUFD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dUJBQ0wsS0FBSztvQ0FDTCxLQUFLO3lCQUNMLEtBQUs7cUJBQ0wsS0FBSzt1QkFDTCxLQUFLO2lCQUNMLEtBQUs7bUJBQ0wsS0FBSzswQkFDTCxLQUFLO3VCQUNMLEtBQUs7eUJBQ0wsS0FBSzs7OztJQW5DTiw0QkFBK0I7O0lBQy9CLDhCQUFpQzs7SUFDakMsNkJBQWtDOztJQUVsQyxpQ0FpQkU7O0lBRUYsMENBQWdFOztJQUVoRSx3Q0FBd0U7O0lBQ3hFLHVDQUF1RTs7SUFDdkUsb0RBQWlHOztJQUNqRyx5Q0FBMEU7O0lBQzFFLHFDQUFrRTs7SUFDbEUsdUNBQXVFOztJQUN2RSxpQ0FBaUU7O0lBQ2pFLG1DQUE4RDs7SUFDOUQsMENBQTRFOztJQUM1RSx1Q0FBdUU7O0lBQ3ZFLHlDQUFxRTs7SUFFckUscUNBQXlDOztJQUV6QyxtQ0FBa0I7O0lBQ2xCLHFDQUF1QiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBXb3JreWxhYi4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vd29ya3lsYWIvbWF0ZXJpYWxpemUtYW5ndWxhci9tYXN0ZXIvTElDRU5TRVxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgZm9yd2FyZFJlZiwgSW5wdXQsIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBjb25maWcgfSBmcm9tICcuLi8uLi9jb25maWcnO1xuaW1wb3J0IHsgRGF0ZU1vZGVsIH0gZnJvbSAnLi4vY2FsZW5kYXIvY2FsZW5kYXIubW9kZWwnO1xuaW1wb3J0IHsgRGF0ZVBpY2tlck1vZGVsIH0gZnJvbSAnLi9kYXRlcGlja2VyLm1vZGVsJztcbmltcG9ydCB7IElOUFVUX1RZUEUgfSBmcm9tICcuLi9pbnB1dC9pbnB1dC5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBwcm92aWRlcnM6IFt7XG4gICAgbXVsdGk6IHRydWUsXG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gRGF0ZVBpY2tlckNvbXBvbmVudClcbiAgfV0sXG4gIHNlbGVjdG9yOiBgJHsgY29uZmlnLmNvbXBvbmVudHMucHJlZml4IH0tZGF0ZXBpY2tlciB9YCxcbiAgdGVtcGxhdGVVcmw6ICcuL2RhdGVwaWNrZXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIERhdGVQaWNrZXJDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25Jbml0IHtcbiAgc3RhdGljIHJlYWRvbmx5IERBWV9LRVkgPSAnZGQnO1xuICBzdGF0aWMgcmVhZG9ubHkgTU9OVEhfS0VZID0gJ21tJztcbiAgc3RhdGljIHJlYWRvbmx5IFlFQVJfS0VZID0gJ3l5eXknO1xuXG4gIHN0YXRpYyByZWFkb25seSBkZWZhdWx0UHJvcHM6IERhdGVQaWNrZXJNb2RlbCA9IHtcbiAgICBhdXRvY29tcGxldGU6ICdub25lJyxcbiAgICBjbGFzc05hbWU6ICcnLFxuICAgIGRhdGU6IG5ldyBEYXRlKCksXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIGRpc3BsYXlPdGhlck1vbnRoRGF5czogdHJ1ZSxcbiAgICBmbG9hdExhYmVsOiAnJyxcbiAgICBmb3JtYXQ6ICdkZC1tbS15eXl5JyxcbiAgICBmdWxsU2l6ZTogZmFsc2UsXG4gICAgaGFzQ291bnRlcjogZmFsc2UsXG4gICAgaWQ6IG51bGwsXG4gICAgbWF4TGVuZ3RoOiA1MDAsXG4gICAgbmFtZTogJycsXG4gICAgcGxhY2Vob2xkZXI6ICcnLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICB0eXBlOiBJTlBVVF9UWVBFLlRFWFQsXG4gICAgdmFsdWU6ICcnXG4gIH07XG5cbiAgQFZpZXdDaGlsZCgnYmFja2Ryb3AnLCB7c3RhdGljOiBmYWxzZX0pIGJhY2tkcm9wUmVmOiBFbGVtZW50UmVmO1xuXG4gIEBJbnB1dCgpIGNsYXNzTmFtZTogc3RyaW5nID0gRGF0ZVBpY2tlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMuY2xhc3NOYW1lO1xuICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbiA9IERhdGVQaWNrZXJDb21wb25lbnQuZGVmYXVsdFByb3BzLmRpc2FibGVkO1xuICBASW5wdXQoKSBkaXNwbGF5T3RoZXJNb250aERheXM6IGJvb2xlYW4gPSBEYXRlUGlja2VyQ29tcG9uZW50LmRlZmF1bHRQcm9wcy5kaXNwbGF5T3RoZXJNb250aERheXM7XG4gIEBJbnB1dCgpIGZsb2F0TGFiZWw6IHN0cmluZyA9IERhdGVQaWNrZXJDb21wb25lbnQuZGVmYXVsdFByb3BzLmZsb2F0TGFiZWw7XG4gIEBJbnB1dCgpIGZvcm1hdDogc3RyaW5nID0gRGF0ZVBpY2tlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMuZm9ybWF0O1xuICBASW5wdXQoKSBmdWxsU2l6ZTogYm9vbGVhbiA9IERhdGVQaWNrZXJDb21wb25lbnQuZGVmYXVsdFByb3BzLmZ1bGxTaXplO1xuICBASW5wdXQoKSBpZDogc3RyaW5nIHwgbnVsbCA9IERhdGVQaWNrZXJDb21wb25lbnQuZGVmYXVsdFByb3BzLmlkO1xuICBASW5wdXQoKSBuYW1lOiBzdHJpbmcgPSBEYXRlUGlja2VyQ29tcG9uZW50LmRlZmF1bHRQcm9wcy5uYW1lO1xuICBASW5wdXQoKSBwbGFjZWhvbGRlcjogc3RyaW5nID0gRGF0ZVBpY2tlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMucGxhY2Vob2xkZXI7XG4gIEBJbnB1dCgpIHJlcXVpcmVkOiBib29sZWFuID0gRGF0ZVBpY2tlckNvbXBvbmVudC5kZWZhdWx0UHJvcHMucmVxdWlyZWQ7XG4gIEBJbnB1dCgpIGlucHV0VmFsdWU6IHN0cmluZyA9IERhdGVQaWNrZXJDb21wb25lbnQuZGVmYXVsdFByb3BzLnZhbHVlO1xuXG4gIHB1YmxpYyBwcmVmaXggPSBjb25maWcuY29tcG9uZW50cy5wcmVmaXg7XG5cbiAgcHVibGljIGRhdGU6IERhdGU7XG4gIHB1YmxpYyBpc09wZW46IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcblxuICAgIHRoaXMuY2xvc2UgPSB0aGlzLmNsb3NlLmJpbmQodGhpcyk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICAvLyB0aGlzLmRhdGUgPSB0aGlzLmJ1aWxkRGF0ZSh0aGlzLmlucHV0VmFsdWUpO1xuICB9XG5cbiAgb25TZWxlY3REYXkoc2VsZWN0ZWREYXRlOiBEYXRlTW9kZWwpIHtcbiAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuZGF0ZSA9IHNlbGVjdGVkRGF0ZS5kYXRlO1xuICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMuZm9ybWF0RGF0ZShzZWxlY3RlZERhdGUuZGF0ZSk7XG5cbiAgICB0aGlzLm9uQ2hhbmdlKHNlbGVjdGVkRGF0ZS5kYXRlKTtcbiAgfVxuXG4gIGZvcm1hdERhdGUoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XG4gICAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XG4gICAgY29uc3QgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxO1xuXG4gICAgY29uc3QgZGF5U3RyaW5nID0gZGF5IDwgMTBcbiAgICAgID8gYDAkeyBkYXkgfWBcbiAgICAgIDogZGF5LnRvU3RyaW5nKCk7XG5cbiAgICBjb25zdCBtb250aFN0cmluZyA9IG1vbnRoIDwgMTBcbiAgICAgID8gYDAkeyBtb250aCB9YFxuICAgICAgOiBtb250aC50b1N0cmluZygpO1xuXG4gICAgY29uc3QgeWVhclN0cmluZyA9IGRhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpO1xuXG4gICAgY29uc3QgZm9ybWF0ZWREYXRlID0gdGhpcy5mb3JtYXRcbiAgICAgIC5yZXBsYWNlKCdkZCcsIGRheVN0cmluZylcbiAgICAgIC5yZXBsYWNlKCdtbScsIG1vbnRoU3RyaW5nKVxuICAgICAgLnJlcGxhY2UoJ3l5eXknLCB5ZWFyU3RyaW5nKTtcblxuICAgIHJldHVybiBmb3JtYXRlZERhdGU7XG4gIH1cblxuICBidWlsZERhdGUodmFsdWU6IHN0cmluZyk6IERhdGUge1xuICAgIGNvbnN0IGRheVN0YXJ0UG9zaXRpb24gPSB0aGlzLmZvcm1hdC5pbmRleE9mKERhdGVQaWNrZXJDb21wb25lbnQuREFZX0tFWSk7XG4gICAgY29uc3QgbW9udGhTdGFydFBvc2l0aW9uID0gdGhpcy5mb3JtYXQuaW5kZXhPZihEYXRlUGlja2VyQ29tcG9uZW50Lk1PTlRIX0tFWSk7XG4gICAgY29uc3QgeWVhclN0YXJ0UG9zaXRpb24gPSB0aGlzLmZvcm1hdC5pbmRleE9mKERhdGVQaWNrZXJDb21wb25lbnQuWUVBUl9LRVkpO1xuXG4gICAgaWYgKGRheVN0YXJ0UG9zaXRpb24gPj0gMCAmJiBtb250aFN0YXJ0UG9zaXRpb24gPj0gMCAmJiB5ZWFyU3RhcnRQb3NpdGlvbiA+PSAwKSB7XG4gICAgICBjb25zdCBkYXlFbmRQb3NpdGlvbiA9IGRheVN0YXJ0UG9zaXRpb24gKyBEYXRlUGlja2VyQ29tcG9uZW50LkRBWV9LRVkubGVuZ3RoO1xuICAgICAgY29uc3QgbW9udGhFbmRQb3NpdGlvbiA9IG1vbnRoU3RhcnRQb3NpdGlvbiArIERhdGVQaWNrZXJDb21wb25lbnQuTU9OVEhfS0VZLmxlbmd0aDtcbiAgICAgIGNvbnN0IHllYXJFbmRQb3NpdGlvbiA9IHllYXJTdGFydFBvc2l0aW9uICsgRGF0ZVBpY2tlckNvbXBvbmVudC5ZRUFSX0tFWS5sZW5ndGg7XG5cbiAgICAgIGNvbnN0IGRheVN0cmluZyA9IHZhbHVlLnN1YnN0cmluZyhkYXlTdGFydFBvc2l0aW9uLCBkYXlFbmRQb3NpdGlvbik7XG4gICAgICBjb25zdCBtb250aFN0cmluZyA9IHZhbHVlLnN1YnN0cmluZyhtb250aFN0YXJ0UG9zaXRpb24sIG1vbnRoRW5kUG9zaXRpb24pO1xuICAgICAgY29uc3QgeWVhclN0cmluZyA9IHZhbHVlLnN1YnN0cmluZyh5ZWFyU3RhcnRQb3NpdGlvbiwgeWVhckVuZFBvc2l0aW9uKTtcblxuICAgICAgaWYgKGRheVN0cmluZyAmJiBtb250aFN0cmluZyAmJiB5ZWFyU3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGRheSA9IE51bWJlcihkYXlTdHJpbmcpO1xuICAgICAgICBjb25zdCBtb250aCA9IE51bWJlcihtb250aFN0cmluZykgLSAxO1xuICAgICAgICBjb25zdCB5ZWFyID0gTnVtYmVyKHllYXJTdHJpbmcpO1xuXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IERhdGUoKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5pc09wZW4gPSB0cnVlO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmJhY2tkcm9wUmVmLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsb3NlKTtcbiAgICB9LCAwKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XG4gIH1cblxuICBvbklucHV0Q2hhbmdlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmRhdGUgPSB0aGlzLmJ1aWxkRGF0ZSh2YWx1ZSk7XG5cbiAgICB0aGlzLm9uQ2hhbmdlKHRoaXMuZGF0ZSk7XG4gIH1cblxuICBvbklucHV0Rm9jdXMoKSB7XG4gICAgdGhpcy5vblRvdWNoZWQoKTtcbiAgfVxuXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogRGF0ZSk6IHZvaWQge1xuICAgIHRoaXMuZGF0ZSA9IHZhbHVlO1xuXG4gICAgdGhpcy5pbnB1dFZhbHVlID0gdGhpcy5mb3JtYXREYXRlKHZhbHVlKTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogRGF0ZSkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIG9uQ2hhbmdlKHZhbHVlOiBEYXRlKTogdm9pZCB7XG4gIH1cblxuICBvblRvdWNoZWQoKTogdm9pZCB7fVxufVxuIl19